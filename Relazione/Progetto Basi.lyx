#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\use_default_options true
\begin_modules
linguistics
\end_modules
\maintain_unincluded_children false
\language english
\language_package auto
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize a4paper
\use_geometry true
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1.5cm
\topmargin 1.5cm
\rightmargin 1.5cm
\bottommargin 1.9cm
\headheight 0cm
\headsep 0cm
\footskip 0cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Progetto basi di dati
\begin_inset Newline newline
\end_inset

Ristorante
\end_layout

\begin_layout Author
Francesco Sgarbossa - matr.
 1005263
\begin_inset Newline newline
\end_inset

Pietro Gabelli - matr.
 1008028
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename vf/il_vecchio_pasta.jpg
	scale 70

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Abstract
Il progetto modella la gestione del lato rivolto al cliente di un ristorante.
 
\end_layout

\begin_layout Abstract
Vengono gestite le prenotazioni immesse dai clienti, per ciascuna di queste,
 le informazioni relative alla persona che l'ha inserita ed i piatti scelti.
 
\end_layout

\begin_layout Abstract
Le operazioni tipiche sono la registrazione d'un nuovo cliente, la creazione
 d'una prenotazione con la scelta d'un menù, l'aggiornamento o modifica
 dei piatti del ristorante e l'emissione di ricevute.
\end_layout

\begin_layout Section
Descrizone dei requisiti
\end_layout

\begin_layout Standard
Il progetto consiste nella realizzazione di una base di dati che modelli
 alcune classi coinvolte nella gestione di un ristorante; il personale e
 la clientela interagiscono con la base di dati tramite differenti parti
 dell'interfaccia web.
\end_layout

\begin_layout Standard
L'entità principale che si desidera gestire è la singola prenotazione.
 Di ognuna interessa in numero di posti richiesti, la data in che si desidera
 riservare e quella in cui è stata effettuata.
\end_layout

\begin_layout Standard
Interessa gestire principalmente la parte relativa ai clienti: ognuno di
 essi avrà come attributi, oltre al nome e cognome, un eventuale recapito
 (telefonico o e-mail od entrambi) e la data in cui s'è registrato; i piatti
 che si desidera ordinare e per ognuno il numero di porzioni.
\end_layout

\begin_layout Standard
Dei piatti che offre il ristorante interessa il nome ed il costo.
 I piatti si dividono in antipasti, primi, secondi, contorni, dolci, piatti
 speciali e bevande.
\end_layout

\begin_layout Standard
Le prenotazioni sono effettuate da dei clienti di cui interessa il nome,
 il cognome e la data di registrazione; sono facoltativi un indirizzo e-mail
 ed un contatto telefonico.
 Vengono memorizzati separatamente le credenziali degli utenti del sistema,
 che si dividono in utenti di primo livello (cliente semplice) e di secondo
 livello (gestore).
 Entrambi possono effettuare le prenotazioni.
\end_layout

\begin_layout Standard
Viene implementata una raccolta punti come sistema di fideizzazione: permette
 di accumulare punti in base alla spesa effettuata dal sigolo cliente e
 di ottenere sconti sugli acquisti futuri.
 Ciascuna carta fedeltà contiene quindi i punti accumulati e non ancora
 spesi dal cliente.
\end_layout

\begin_layout Standard
Le ricevute vengono emesse su una specifica prenotazione.
 Ognuna contiene i punti che sono stati scalati ed il totale che si è pagato.
\end_layout

\begin_layout Standard
Viene tenuta traccia dell'accesso al sistema da parte della clientela, tramite
 una tabella in cui è riportata la data d'accesso.
\end_layout

\begin_layout Standard

\shape italic
Nota: Per accedere al sistema sono stati creati due account: cliente e gestore,
 la cui password è provaprova.
 La password è la stessa anche per gli altri utenti.
\end_layout

\begin_layout Section
Progettazione concettuale
\end_layout

\begin_layout Subsection
Lista delle classi
\end_layout

\begin_layout Standard

\series bold
Prenotazioni
\series default
: modella una generica prenotazione.
\end_layout

\begin_layout Itemize
Datacrea: 
\shape italic
date
\end_layout

\begin_layout Itemize
Data pren: 
\shape italic
date
\end_layout

\begin_layout Itemize
NumeroPosti: 
\shape italic
int
\end_layout

\begin_layout Standard

\series bold
Utenti: 
\series default
rappresenta gli utenti del sito (i clienti che fanno le prenotazioni e la
 staff del ristorante).
\end_layout

\begin_layout Itemize
\noindent
Nome: 
\shape italic
string
\end_layout

\begin_layout Itemize
\noindent
Cognome: 
\shape italic
string
\end_layout

\begin_layout Itemize
\noindent
E-mail: 
\shape italic
string
\end_layout

\begin_layout Itemize
\noindent
Telefono: 
\shape italic
int
\end_layout

\begin_layout Itemize
DataReg: 
\shape italic
date
\end_layout

\begin_layout Standard

\series bold
Utenti
\series default
: contiene le credenziali d'ogni utente del sistema
\end_layout

\begin_layout Itemize
Login: 
\shape italic
string
\end_layout

\begin_layout Itemize
Password: 
\shape italic
float
\end_layout

\begin_layout Standard
Sono definite le seguenti sottoclassi:
\end_layout

\begin_layout Standard
Primo Livello: rappresenta i clienti semplici;
\end_layout

\begin_layout Standard
Secondo Livello: rappresenta i gestori.
\end_layout

\begin_layout Standard
\paragraph_spacing double
\noindent

\series bold
Piatti
\series default
: modella un generico piatto presente nel menù.
\end_layout

\begin_layout Itemize
Nome: 
\shape italic
string
\end_layout

\begin_layout Itemize
Costo: 
\shape italic
float
\end_layout

\begin_layout Standard
Sono definite le seguenti sottoclassi:
\end_layout

\begin_layout Standard

\series bold
Antipasti
\series default
: rappresenta gli antipasti che serve il ristorante;
\end_layout

\begin_layout Standard

\series bold
Primi
\series default
: rappresenta gli antipasti che serve il ristorante;
\end_layout

\begin_layout Standard

\series bold
Secondi
\series default
: rappresenta gli antipasti che serve il ristorante;
\end_layout

\begin_layout Standard

\series bold
Contorni
\series default
: rappresenta gli antipasti che serve il ristorante;
\end_layout

\begin_layout Standard

\series bold
Dolci
\series default
: rappresenta gli antipasti che serve il ristorante;
\end_layout

\begin_layout Standard

\series bold
Piatti speciali
\series default
: rappresenta piatti particolari non inseriti stabilmente nel menù.
\end_layout

\begin_layout Standard
\paragraph_spacing double
\noindent

\series bold
Accessi
\series default
: contiene lo storico degli accessi.
\end_layout

\begin_layout Itemize
DataAccesso: 
\shape italic
date
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
CartaFedeltà
\series default
: contiene i punti guardagnati dal singolo cliente.
\end_layout

\begin_layout Itemize
TotPunti: 
\shape italic
int
\end_layout

\begin_layout Standard
Ricevute: modella uno scontrino
\end_layout

\begin_layout Itemize
Totale: 
\shape slanted
float
\end_layout

\begin_layout Itemize
TotPunti: 
\shape italic
int
\end_layout

\begin_layout Subsection
Lista delle associazioni
\end_layout

\begin_layout Itemize

\shape smallcaps
Prenotazioni - Piatti: 
\series bold
\shape default
è stato ordinato
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni prenotazione contiene zero o più piatti.
 Ogni piatto può essere contenuto in zero o più prenotazioni, eventualmente
 nessuna.
\end_layout

\begin_layout Itemize
Molteplicità N:M
\end_layout

\begin_layout Itemize
Totalità: parziale verso 
\shape smallcaps
Piatti
\shape default
, parziale verso 
\shape smallcaps
Prenotazioni
\shape default
.
\end_layout

\begin_layout Itemize
Attributi:
\end_layout

\begin_deeper
\begin_layout Itemize
Nporzioni: 
\shape italic
int
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize

\shape smallcaps
Clienti - Prenotazioni
\shape default
: 
\series bold
ha effettuato
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente ha fatto zero o più prenotazioni.
 Ogni prenotazione è stata fatta da un cliente.
\end_layout

\begin_layout Itemize
Molteplicità N:1
\end_layout

\begin_layout Itemize
Totalità: totale verso 
\shape smallcaps
Clienti
\shape default
, parziale verso 
\shape smallcaps
Prenotazioni
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Clienti - Utenti
\shape default
: 
\series bold
credenziali
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente possiede uno ed un solo set di credenziali.
 Ogni set di credenziali è associato esattamente ad un cliente.
\end_layout

\begin_layout Itemize
Molteplicità 1:1
\end_layout

\begin_layout Itemize
Totalità: totale verso 
\shape smallcaps
Clienti
\shape default
, totale verso 
\shape smallcaps
Utenti
\shape default
.
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Clienti - CartaFedelta
\shape default
: 
\series bold
possiede
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente possiede esattamente una carta fedeltà.
 Ogni carta fedeltà è associata ad un cliente.
\end_layout

\begin_layout Itemize
Molteplicità 1:1
\end_layout

\begin_layout Itemize
Totalità: totale in entrabi i versi.
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Accessi - Clienti
\shape default
: 
\series bold
associato a
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente ha effettuato l'accesso zero o più volte; ogni log è associato
 ad un solo cliente
\end_layout

\begin_layout Itemize
Molteplicità 1:N
\end_layout

\begin_layout Itemize
Totalità: totale in entrambi i versi.
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Ricevute - Prenotazioni
\shape default
: 
\series bold
scontrino
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni scontrino è relativo ad una sola prenotazione.
 Ogni prenotazione è associata ad una sola ricevuta, eventualmente nessuna.
\end_layout

\begin_layout Itemize
Molteplicità 1:1
\end_layout

\begin_layout Itemize
Totalità: totale verso 
\shape smallcaps
Prenotazioni
\shape default
, parziale verso 
\shape smallcaps
Ricevute
\shape default
.
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset External
	template Dia
	filename Concettuale.dia
	rotateAngle 90

\end_inset

Schema concettuale della base di dati
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Progettazione logica
\end_layout

\begin_layout Subsection
Gerarchie
\end_layout

\begin_layout Standard
La gerarchia della classe 
\shape smallcaps
Piatti
\shape default
 è stata realizzata tramite partizionamento verticale, definendo le classi
 
\shape smallcaps
Antipasti, Primi, Secondi, Contorni, Dolci, Piatti Speciali
\shape default
,
\shape smallcaps
 Bevande
\shape default
.
 Ognuna utilizza come chiave esterna verso 
\shape smallcaps
Piatti
\shape default
 la chiave.
 La gerarchia completa viene quindi implementata usando le seguenti classi:
\end_layout

\begin_layout Description

\shape smallcaps
Piatti
\shape default
: viene istituita una nuova chiave sintetica intera.
 
\end_layout

\begin_layout Itemize
CodPiatto: 
\shape italic
int
\shape default
 «PK»
\end_layout

\begin_layout Itemize
Nome: 
\shape italic
string
\shape default
 «NOT NULL»
\end_layout

\begin_layout Itemize
Costo: 
\shape italic
float
\shape default
 «NOT NULL»
\end_layout

\begin_layout Description

\shape smallcaps
Antipasti
\shape default
: si utilizza CodPiatto come chiave esterna verso Piatti
\end_layout

\begin_layout Itemize
CodPiatto: 
\shape italic
int
\shape default
 «PK» «FK(
\shape smallcaps
Piatti
\shape default
)»
\end_layout

\begin_layout Standard

\series bold
\shape smallcaps
Primi, Secondi, Contorni, Dolci, Piatti Speciali, Bibite
\series default
\shape default
: come sopra.
\end_layout

\begin_layout Standard
\paragraph_spacing double
\noindent
La gerarchia della classe Utenti è stata realizzata tramite relazione unica,
 con la creazione di un attributo discriminatore che specifica il livello.
 La gerarchia viene quindi implementata nel seguente modo:
\end_layout

\begin_layout Standard
\paragraph_spacing double
\noindent

\series bold
Utenti
\series default
: si utilizza livello come discriminatore del livello dell'utente.
\end_layout

\begin_layout Itemize
Login: 
\shape italic
string
\end_layout

\begin_layout Itemize
password: 
\shape italic
string
\end_layout

\begin_layout Itemize
livello: 
\shape italic
int
\end_layout

\begin_layout Subsection
Chiavi sintetiche
\end_layout

\begin_layout Standard
Sono state aggiunte chiavi primarie sintetiche intere alle tabelle 
\shape smallcaps
Prenotazioni, Clienti 
\shape default
ed
\shape smallcaps
 Accessi.
\end_layout

\begin_layout Subsection
Associazioni
\end_layout

\begin_layout Itemize

\shape smallcaps
Prenotazioni - Piatti: 
\series bold
\shape default
è stato ordinato
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni prenotazione contiene zero o più piatti.
 Ogni piatto può essere contenuto in zero o più prenotazioni, eventualmente
 nessuna.
\end_layout

\begin_layout Itemize
Molteplicità N:M
\end_layout

\begin_layout Itemize
Totalità: parziale verso 
\shape smallcaps
Piatti
\shape default
, parziale verso 
\shape smallcaps
Prenotazioni
\end_layout

\begin_layout Itemize
Nuova tablella: 
\series bold
PrenotazioniPiatti
\series default
, con i seguenti attributi:
\end_layout

\begin_deeper
\begin_layout Itemize
CodPrenotazione: int «PK» «FK(
\shape smallcaps
Prenotazioni
\shape default
)»
\end_layout

\begin_layout Itemize
CodPiatto: int «PK» «FK(
\shape smallcaps
Piatti
\shape default
)»
\end_layout

\begin_layout Itemize
Nporzioni: int «NOT NULL»
\end_layout

\end_deeper
\end_deeper
\begin_layout Itemize

\shape smallcaps
Clienti - Prenotazioni
\shape default
: 
\series bold
ha effettuato
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente ha fatto zero o più prenotazioni.
 Ogni prenotazione è stata fatta da un cliente.
\end_layout

\begin_layout Itemize
Molteplicità N:1
\end_layout

\begin_layout Itemize
Totalità: totale verso 
\shape smallcaps
Clienti
\shape default
, parziale verso 
\shape smallcaps
Prenotazioni
\end_layout

\begin_layout Itemize
Chiave esterna non nulla in 
\shape smallcaps
Prenotazioni
\shape default
 verso 
\shape smallcaps
Clienti
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Clienti - Utenti
\shape default
: 
\series bold
credenziali
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente possiede uno ed un solo set di credenziali.
 Ogni set di credenziali è associato esattamente ad un cliente.
\end_layout

\begin_layout Itemize
Molteplicità 1:1
\end_layout

\begin_layout Itemize
Totalità: totale verso 
\shape smallcaps
Clienti
\shape default
, totale verso 
\shape smallcaps
Utenti
\end_layout

\begin_layout Itemize
Chiave esterna non nulla in 
\shape smallcaps
Utenti
\shape default
 verso 
\shape smallcaps
Clienti
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Clienti - CartaFedelta
\shape default
: 
\series bold
possiede
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente possiede esattamente una carta fedeltà.
 Ogni carta fedeltà è associata ad un cliente.
\end_layout

\begin_layout Itemize
Molteplicità 1:1
\end_layout

\begin_layout Itemize
Totalità: totale in entrabi i versi
\end_layout

\begin_layout Itemize
Chiave esterna non nulla in 
\shape smallcaps
CartaFedelta
\shape default
 verso 
\shape smallcaps
Clienti
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Accessi - Clienti
\shape default
: 
\series bold
associato a
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni cliente ha effettuato l'accesso zero o più volte; ogni accesso è associato
 ad un solo cliente
\end_layout

\begin_layout Itemize
Molteplicità 1:N
\end_layout

\begin_layout Itemize
Totalità: totale in entrambi i versi
\end_layout

\begin_layout Itemize
Chiave esterna non nulla in 
\shape smallcaps
Accessi
\shape default
 verso 
\shape smallcaps
Clienti
\end_layout

\end_deeper
\begin_layout Itemize

\shape smallcaps
Ricevute - Prenotazioni
\shape default
: 
\series bold
scontrino
\end_layout

\begin_deeper
\begin_layout Itemize
Ogni scontrino è relativo ad una sola prenotazione.
 Ogni prenotazione è associata ad una sola ricevuta, eventualmente nessuna.
\end_layout

\begin_layout Itemize
Molteplicità 1:1
\end_layout

\begin_layout Itemize
Totalità: totale verso Prenotazioni, parziale verso Ricevute.
\end_layout

\begin_layout Itemize
Chiave esterna non nulla in 
\shape smallcaps
Ricevute
\shape default
 verso 
\shape smallcaps
Prenotazioni
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset External
	template Dia
	filename logico.dia
	rotateAngle 90

\end_inset

 Schema logico
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Section
Implementazione della base di dati
\end_layout

\begin_layout Standard
È stata implementata una tablella aggiuntiva, Errori, che contiene la descrizion
e degli errori rilevati dai trigger.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\rmfamily},firstnumber=last,frame=single,language=SQL,numbers=left,numberstyle={\normalsize},showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

set foreign_key_checks=0;
\end_layout

\begin_layout Plain Layout

drop table if exists Antipasti;
\end_layout

\begin_layout Plain Layout

drop table if exists Primi;
\end_layout

\begin_layout Plain Layout

drop table if exists Secondi;
\end_layout

\begin_layout Plain Layout

drop table if exists Contorni;
\end_layout

\begin_layout Plain Layout

drop table if exists Dolci;
\end_layout

\begin_layout Plain Layout

drop table if exists PiattiSpeciali;
\end_layout

\begin_layout Plain Layout

drop table if exists Bevande;
\end_layout

\begin_layout Plain Layout

drop table if exists PrenotazioniPiatti;
\end_layout

\begin_layout Plain Layout

drop table if exists Prenotazioni;
\end_layout

\begin_layout Plain Layout

drop table if exists Utenti;
\end_layout

\begin_layout Plain Layout

drop table if exists Accessi;
\end_layout

\begin_layout Plain Layout

drop table if exists Piatti;
\end_layout

\begin_layout Plain Layout

drop table if exists CartaFedelta;
\end_layout

\begin_layout Plain Layout

drop table if exists Clienti;
\end_layout

\begin_layout Plain Layout

drop table if exists Ricevute;
\end_layout

\begin_layout Plain Layout

drop table if exists Errori;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Errori(
\end_layout

\begin_layout Plain Layout

  CodErr int primary key,
\end_layout

\begin_layout Plain Layout

  Descrizione varchar(255)
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Clienti(
\end_layout

\begin_layout Plain Layout

  Id int primary key,
\end_layout

\begin_layout Plain Layout

  Nome varchar(20) not null,
\end_layout

\begin_layout Plain Layout

  Cognome varchar(20) not null,
\end_layout

\begin_layout Plain Layout

  Email varchar(40),
\end_layout

\begin_layout Plain Layout

  Telefono varchar(20) not null,
\end_layout

\begin_layout Plain Layout

  DataReg date
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Utenti (
\end_layout

\begin_layout Plain Layout

  Id int primary key,
\end_layout

\begin_layout Plain Layout

  Login varchar(20) not null unique,
\end_layout

\begin_layout Plain Layout

  password varchar(40) not null,
\end_layout

\begin_layout Plain Layout

  livello int default 1,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Id) REFERENCES Clienti(Id)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE ON UPDATE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table CartaFedelta (
\end_layout

\begin_layout Plain Layout

  IdCliente int primary key,
\end_layout

\begin_layout Plain Layout

  TotPunti int default 0,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (IdCliente) REFERENCES Clienti(Id)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE ON UPDATE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  DELIMITER $
\end_layout

\begin_layout Plain Layout

  create trigger NuovaCarta
\end_layout

\begin_layout Plain Layout

  after insert on Clienti
\end_layout

\begin_layout Plain Layout

  for each row
\end_layout

\begin_layout Plain Layout

  begin
\end_layout

\begin_layout Plain Layout

    insert into CartaFedelta
\end_layout

\begin_layout Plain Layout

      values(new.Id, 0);
\end_layout

\begin_layout Plain Layout

  end $
\end_layout

\begin_layout Plain Layout

  DELIMITER ;
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Fino a qui sono state create le tabelle 
\shape smallcaps
Errori
\shape default
, 
\shape smallcaps
Clienti
\shape default
, 
\shape smallcaps
Utenti
\shape default
, 
\shape smallcaps
CartaFedelta
\shape default
 ed il trigger NuovaCarta, che crea una nuova Carta Fedeltà alla creazione
 d'un nuovo utente.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "firstnumber=last,frame=single,language=SQL,numbers=left,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

create table Accessi(
\end_layout

\begin_layout Plain Layout

  CodLog int primary key,
\end_layout

\begin_layout Plain Layout

  CodCliente int not null,
\end_layout

\begin_layout Plain Layout

  DataAccesso date not null,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (CodCliente) REFERENCES Clienti(Id)
\end_layout

\begin_layout Plain Layout

    ON DELETE NO ACTION ON UPDATE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Prenotazioni(
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  DataCrea date not null,
\end_layout

\begin_layout Plain Layout

  DataPren date not null,
\end_layout

\begin_layout Plain Layout

  NumeroPosti int not null,
\end_layout

\begin_layout Plain Layout

  CodCliente int,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (CodCliente) REFERENCES Clienti(Id)
\end_layout

\begin_layout Plain Layout

    ON DELETE NO ACTION ON UPDATE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Piatti (
\end_layout

\begin_layout Plain Layout

  CodPiatto int  primary key,
\end_layout

\begin_layout Plain Layout

  Nome varchar(120) not null,
\end_layout

\begin_layout Plain Layout

  Costo float not null
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Antipasti (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Primi (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

create table Secondi (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Contorni (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Dolci (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table PiattiSpeciali (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Bevande (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (Codice) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In questo frammento sono state create le tabelle 
\shape smallcaps
Accessi, Prenotazioni, Piatti, Antipasti, Primi, Secondi, Contorni, Dolci,
 PiattiSpeciali, Bevande.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "firstnumber=last,frame=single,language=SQL,numbers=left,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

create table PrenotazioniPiatti (
\end_layout

\begin_layout Plain Layout

  CodPrenotazione int not null,
\end_layout

\begin_layout Plain Layout

  CodPiatto int not null,
\end_layout

\begin_layout Plain Layout

  NPorzioni int,
\end_layout

\begin_layout Plain Layout

  PRIMARY KEY (CodPrenotazione,CodPiatto),
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (CodPrenotazione) REFERENCES Prenotazioni(Codice)
\end_layout

\begin_layout Plain Layout

    ON DELETE CASCADE,
\end_layout

\begin_layout Plain Layout

  FOREIGN KEY (CodPiatto) REFERENCES Piatti(CodPiatto)
\end_layout

\begin_layout Plain Layout

	ON DELETE CASCADE ON UPDATE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

create table Ricevute (
\end_layout

\begin_layout Plain Layout

  Codice int primary key,
\end_layout

\begin_layout Plain Layout

  Totale float,
\end_layout

\begin_layout Plain Layout

  TotPunti int default 0,
\end_layout

\begin_layout Plain Layout

FOREIGN KEY (Codice) REFERENCES Prenotazioni(Codice)
\end_layout

\begin_layout Plain Layout

    ON DELETE NO ACTION ON UPDATE CASCADE
\end_layout

\begin_layout Plain Layout

  )Engine=InnoDB;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  DELIMITER $
\end_layout

\begin_layout Plain Layout

  create trigger ControlloPunti
\end_layout

\begin_layout Plain Layout

  before insert on Ricevute
\end_layout

\begin_layout Plain Layout

  for each row
\end_layout

\begin_layout Plain Layout

    begin
\end_layout

\begin_layout Plain Layout

    declare PuntiCliente INT;
\end_layout

\begin_layout Plain Layout

      select cf.TotPunti into PuntiCliente
\end_layout

\begin_layout Plain Layout

      from CartaFedelta cf
\end_layout

\begin_layout Plain Layout

      where cf.IdCliente=(select CodCliente from Prenotazioni where Codice=new.Cod
ice);
\end_layout

\begin_layout Plain Layout

      if new.TotPunti>PuntiCliente
\end_layout

\begin_layout Plain Layout

	then 
\end_layout

\begin_layout Plain Layout

	  insert into Errori
\end_layout

\begin_layout Plain Layout

	  values('01','Non ci sono sufficienti punti nella tessera');
\end_layout

\begin_layout Plain Layout

      end if;
\end_layout

\begin_layout Plain Layout

end $
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  create trigger InserisciPunti
\end_layout

\begin_layout Plain Layout

  after insert on Ricevute
\end_layout

\begin_layout Plain Layout

  for each row
\end_layout

\begin_layout Plain Layout

    begin
\end_layout

\begin_layout Plain Layout

    declare TPunti int;
\end_layout

\begin_layout Plain Layout

    declare CodC int;
\end_layout

\begin_layout Plain Layout

    select CodCliente into CodC
\end_layout

\begin_layout Plain Layout

    from Prenotazioni
\end_layout

\begin_layout Plain Layout

    where Codice=new.Codice;
\end_layout

\begin_layout Plain Layout

    Update CartaFedelta 
\end_layout

\begin_layout Plain Layout

    set TotPunti=TotPunti+(new.Totale/10)
\end_layout

\begin_layout Plain Layout

    where IdCliente=CodC;
\end_layout

\begin_layout Plain Layout

  end $
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Qui vengono le create le ultime tabelle, 
\shape smallcaps
PrenotazionePiatti
\shape default
 e 
\shape smallcaps
Ricevute
\shape default
, assieme ad alcuni trigger.
\end_layout

\begin_layout Standard
Il trigger ControlloPunti si assicura che prima di emettere una nuova fattura
 sia possibile scalare i punti dalla Carta fedeltà del cliente cui è associata
 la prenotazione; il trigger InserisciPunti si occupa di aumentare i punti
 del cliente sulla base dell'ammontare della spesa (10€ di spesa fanno guadagnar
e un punto).
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "firstnumber=last,frame=single,language=SQL,numbers=left,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

drop function if exists PrezzoPrenotazione;
\end_layout

\begin_layout Plain Layout

  create function PrezzoPrenotazione(IdP INT)
\end_layout

\begin_layout Plain Layout

  returns decimal(6,2)
\end_layout

\begin_layout Plain Layout

  begin
\end_layout

\begin_layout Plain Layout

    declare total decimal(6,2);
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    select sum(pr.NPorzioni*pi.Costo) into total
\end_layout

\begin_layout Plain Layout

    from PrenotazioniPiatti pr natural join Piatti pi
\end_layout

\begin_layout Plain Layout

    where pr.CodPrenotazione=IdP;
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

return total;
\end_layout

\begin_layout Plain Layout

end $
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  drop function if exists PuntiTotali;
\end_layout

\begin_layout Plain Layout

  create function PuntiTotali(IdC INT)
\end_layout

\begin_layout Plain Layout

  returns INT
\end_layout

\begin_layout Plain Layout

  begin
\end_layout

\begin_layout Plain Layout

    declare nric, punti, tot INT;
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    select count(*) into nric
\end_layout

\begin_layout Plain Layout

    from Ricevute r natural join Prenotazioni p
\end_layout

\begin_layout Plain Layout

    where p.CodCliente=IdC;
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    if (nric=0)
\end_layout

\begin_layout Plain Layout

    then
\end_layout

\begin_layout Plain Layout

      select 0 as Ptotali into punti;
\end_layout

\begin_layout Plain Layout

    else
\end_layout

\begin_layout Plain Layout

      select sum(r.Totale/10) into punti
\end_layout

\begin_layout Plain Layout

      from Ricevute r natural join Prenotazioni p
\end_layout

\begin_layout Plain Layout

      where p.CodCliente=IdC;
\end_layout

\begin_layout Plain Layout

    end if;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    select c.TotPunti into tot
\end_layout

\begin_layout Plain Layout

    from CartaFedelta c
\end_layout

\begin_layout Plain Layout

    where c.IdCliente=IdC;
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    return punti+tot;
\end_layout

\begin_layout Plain Layout

end $
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  drop procedure if exists InserisciRicevuta;
\end_layout

\begin_layout Plain Layout

  create procedure InserisciRicevuta(IdP INT, TPunti INT)
\end_layout

\begin_layout Plain Layout

  begin
\end_layout

\begin_layout Plain Layout

    declare Totale float;
\end_layout

\begin_layout Plain Layout

    select PrezzoPrenotazione(IdP)-2*Tpunti into Totale
\end_layout

\begin_layout Plain Layout

    from Prenotazioni
\end_layout

\begin_layout Plain Layout

	where Codice=IdP;
\end_layout

\begin_layout Plain Layout

    insert into Ricevute values(IdP, Totale, TPunti);
\end_layout

\begin_layout Plain Layout

  end $
\end_layout

\begin_layout Plain Layout

   
\end_layout

\begin_layout Plain Layout

  drop function if exists MaxPunti;
\end_layout

\begin_layout Plain Layout

  create function MaxPunti(IdP INT)
\end_layout

\begin_layout Plain Layout

  returns INT
\end_layout

\begin_layout Plain Layout

  begin
\end_layout

\begin_layout Plain Layout

    declare M1, M2, MaxP INT;
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    select PrezzoPrenotazione(IdP)/10 into M1;
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    select c.TotPunti into M2
\end_layout

\begin_layout Plain Layout

    from Prenotazioni p join CartaFedelta c on p.CodCliente=c.IdCliente
\end_layout

\begin_layout Plain Layout

	where p.Codice=IdP;
\end_layout

\begin_layout Plain Layout

	if(M1<M2) then return M1; 
\end_layout

\begin_layout Plain Layout

	else return M2;
\end_layout

\begin_layout Plain Layout

	end if;
\end_layout

\begin_layout Plain Layout

  end $
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  DELIMITER ;
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

SOURCE insert.sql;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

SET FOREIGN_KEY_CHECKS=1;
\end_layout

\end_inset


\end_layout

\begin_layout Standard
In quest'ultimo frammento, vengono definite alcune funzioni ed una procedura.
\end_layout

\begin_layout Standard
La funzione PrezzoPrenotazione prende come parametro una 
\shape smallcaps
Prenotazione
\shape default
 e restituisce il prezzo totale; la funzione PuntiTotali prende come parametro
 un 
\shape smallcaps
Cliente
\shape default
 e restituisce tutti i punti che ha guadagnato dal momento in cui s'è registrato
, indipendentemente dal fatto che nel frattempo li abbia spesi o meno.
\end_layout

\begin_layout Standard
La procedura InserisciRicevute ha lo scopo di togliere dal costo d'una prenotazi
one lo sconto dato dal numero di punti che viene passato: un punto permette
 di decurtare 2€ dalla spesa; la funzione MaxPunti, data una prenotazione
 restituisce il numero massimo di punti che possono essere decurtati dalla
 prenotazione.
\end_layout

\begin_layout Standard
Lo script insert.sql contiene le istruzioni per popolare le tabelle.
\end_layout

\begin_layout Section
Query
\end_layout

\begin_layout Standard
Alcuni esempi di 
\shape italic
query
\shape default
.
\end_layout

\begin_layout Enumerate
Nome, Cognome ed indirizzo e-mail dei clienti che non hanno effettuato nessuna
 prenotazione e dei clienti che hanno effettuato una prenotazione prima
 del 2008.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "breaklines=true,frame=single,language=SQL"
inline false
status open

\begin_layout Plain Layout

select c.Nome, c.Cognome, c.Email
\end_layout

\begin_layout Plain Layout

from Clienti c
\end_layout

\begin_layout Plain Layout

where c.Id not in (select distinct CodCliente from Prenotazioni join Ricevute)
\end_layout

\begin_layout Plain Layout

union
\end_layout

\begin_layout Plain Layout

	select c.Nome, c.Cognome, c.Email
\end_layout

\begin_layout Plain Layout

	from Clienti c
\end_layout

\begin_layout Plain Layout

	where c.Id in (select distinct CodCliente from Prenotazioni join Ricevute
 where DataCrea<'2008-01-01');
\end_layout

\end_inset

Output:
\begin_inset listings
lstparams "basicstyle={\scriptsize},extendedchars=true"
inline false
status open

\begin_layout Plain Layout

+-------+---------+----------------------+
\end_layout

\begin_layout Plain Layout

| Nome  | Cognome | Email                |
\end_layout

\begin_layout Plain Layout

+-------+---------+----------------------+
\end_layout

\begin_layout Plain Layout

| Paolo | Stizzi  | PStizzi12@hotmail.it |
\end_layout

\begin_layout Plain Layout

+-------+---------+----------------------+
\end_layout

\begin_layout Plain Layout

1 row in set (0.04 sec)
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Voce di costo massimo all'interno delle prenotazioni d'ogni cliente; se
 non ne ha fatte, deve essere pari a 0.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=SQL"
inline false
status open

\begin_layout Plain Layout

drop view if exists PreP;
\end_layout

\begin_layout Plain Layout

Create view PreP as(
\end_layout

\begin_layout Plain Layout

  select pp.CodPrenotazione, max(p.Costo*pp.Nporzioni) as 'Subtot', pp.Nporzioni,
 p.Nome
\end_layout

\begin_layout Plain Layout

  from PrenotazioniPiatti pp natural join Piatti p
\end_layout

\begin_layout Plain Layout

  group by pp.CodPrenotazione
\end_layout

\begin_layout Plain Layout

);
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

select p.CodPrenotazione as CodPren, p.Nporzioni as 'Q.ta', p.Nome as NomeP,
 max(p.Subtot) as Subtot, pr.DataPren, c.Nome as NomeC, c.Cognome, c.Id
\end_layout

\begin_layout Plain Layout

from PreP p, Prenotazioni pr join Clienti c on pr.CodCliente=c.Id
\end_layout

\begin_layout Plain Layout

where p.CodPrenotazione=pr.Codice
\end_layout

\begin_layout Plain Layout

group by c.Id
\end_layout

\begin_layout Plain Layout

union
\end_layout

\begin_layout Plain Layout

	select '-' as CodPren, '-' as 'Q.ta', '-' as NomeP, 0 as Subtot, '-' as
 DataPren, Nome as NomeC, Cognome, Id
\end_layout

\begin_layout Plain Layout

	from Clienti
\end_layout

\begin_layout Plain Layout

	where Id not in (select distinct CodCliente from Prenotazioni join Ricevute)
\end_layout

\begin_layout Plain Layout

order by Subtot desc;
\end_layout

\end_inset

Output (i nomi dei piatti sono stati troncati):
\begin_inset listings
lstparams "basicstyle={\tiny}"
inline false
status open

\begin_layout Plain Layout
\align left

+-------+----+---------------------------------------------------+------+-------
-----+---------+---------+--+
\end_layout

\begin_layout Plain Layout
\align left

|CodPren|Q.ta|NomeP                                              |Subtot|
 DataPren   |NomeC    |Cognome  |Id|
\end_layout

\begin_layout Plain Layout
\align left

+-------+----+---------------------------------------------------+------+-------
-----+---------+---------+--+
\end_layout

\begin_layout Plain Layout
\align left

| 2     | 3  |Pate' di fegatini, fatto in casa, con crostini     |150.00|
 2014-08-14 |Anna     |Barletta | 4|
\end_layout

\begin_layout Plain Layout
\align left

| 0     | 3  |Clafoutis di carciofi                              | 78.00|
 2014-07-06 |Federico |Scrivani |14|
\end_layout

\begin_layout Plain Layout
\align left

| 30    | 1  |Pollo piccante con salsa Tandoori e tortino di riso| 78.00|
 2014-07-23 |Mattia   |Patti    |19|
\end_layout

\begin_layout Plain Layout
\align left

| 14    | 3  |Pollo piccante con salsa Tandoori e tortino di riso| 54.00|
 2014-06-16 |Michele  |Diasio   |15|
\end_layout

\begin_layout Plain Layout
\align left

| 1     | 2  |Declinazioni di cioccolato.
 Torta di mandorle e cio| 54.00| 2014-07-08 |Carlo    |Milo     | 2|
\end_layout

\begin_layout Plain Layout
\align left

| 17    | 3  |Casarecce con zucca, gorgonzola, semi di zucca e pa| 54.00|
 2014-06-04 |Paolo    |Spano    |20|
\end_layout

\begin_layout Plain Layout
\align left

| 21    | 3  |Stracciatella di bufala, pomodori alla Provenzale e| 54.00|
 2014-06-18 |Matteo   |Legato   |13|
\end_layout

\begin_layout Plain Layout
\align left

| 3     | 1  |Indivia brasata, bagna caoda gentile e foglie di pa| 54.00|
 2014-07-30 |Lucrezia |Pivato   |17|
\end_layout

\begin_layout Plain Layout
\align left

| 5     | 3  |Insalatina con uva, noci, melograno ed anatra marin| 54.00|
 2014-08-03 |Tommaso  |Galeni   |16|
\end_layout

\begin_layout Plain Layout
\align left

| 8     | 2  |Pollo piccante con salsa Tandoori e tortino di riso| 52.00|
 2014-06-04 |Livia    |Rampolli | 5|
\end_layout

\begin_layout Plain Layout
\align left

| 6     | 3  |Caffe'                                             | 52.00|
 2014-08-23 |Micol    |Davidson |10|
\end_layout

\begin_layout Plain Layout
\align left

| 20    | 1  |Spaghetti con pancetta e fonduta di Reggiano allo Z| 48.00|
 2014-06-11 |Gianna   |Missis   | 8|
\end_layout

\begin_layout Plain Layout
\align left

| 66    | 3  |Straccetti di grano duro con broccolo al vino e sal| 48.00|
 2014-07-20 |Matteo   |Moccoli  | 6|
\end_layout

\begin_layout Plain Layout
\align left

| 47    | 3  |Indivia brasata, bagna caoda gentile e foglie di pa| 48.00|
 2014-06-16 |Lucia    |Felice   |12|
\end_layout

\begin_layout Plain Layout
\align left

| 13    | 2  |Linguine con ragu' di mare (pescato del giorno e sa| 48.00|
 2014-08-25 |Paolo    |Grano    |18|
\end_layout

\begin_layout Plain Layout
\align left

| 9     | 2  |Clafoutis di carciofi                              | 48.00|
 2014-07-21 |Francesco|DeAngelis|11|
\end_layout

\begin_layout Plain Layout
\align left

| 4     | 3  |Casarecce con zucca, gorgonzola, semi di zucca e pa| 48.00|
 2014-08-02 |Fabio    |Moro     | 3|
\end_layout

\begin_layout Plain Layout
\align left

| 56    | 1  |Birra 0.4 lt                                       | 39.00|
 2014-06-11 |Pietro   |Gabelli  | 1|
\end_layout

\begin_layout Plain Layout
\align left

| 16    | 2  |Clafoutis di carciofi                              | 39.00|
 2014-07-31 |Moira    |Orfei    | 9|
\end_layout

\begin_layout Plain Layout
\align left

| 22    | 3  |Vellutata di zucca, rape bianche e porri           | 36.00|
 2014-07-03 |Mirco    |Occhio   | 7|
\end_layout

\begin_layout Plain Layout
\align left

| -     | -  |-                                                  |  0.00|
 -          |Paolo    |Stizzi   |21|
\end_layout

\begin_layout Plain Layout
\align left

+-------+----+---------------------------------------------------+------+-------
-----+---------+---------+--+
\end_layout

\begin_layout Plain Layout
\align left

21 rows in set (0.05 sec)
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Primi 10 clienti che hanno effettuato una prenotazione al ristorante.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "breaklines=true,frame=single,language=SQL"
inline false
status open

\begin_layout Plain Layout

select distinct c.*, p.Codice, p.DataCrea as Creazione
\end_layout

\begin_layout Plain Layout

from Prenotazioni p join Clienti c on p.CodCliente=c.Id
\end_layout

\begin_layout Plain Layout

order by DataCrea 
\end_layout

\begin_layout Plain Layout

LIMIT 10;
\end_layout

\end_inset

Output:
\begin_inset listings
lstparams "basicstyle={\scriptsize}"
inline false
status open

\begin_layout Plain Layout

+--+--------+--------+--------------------+-----------+----------+------+-------
---+
\end_layout

\begin_layout Plain Layout

|Id|Nome    |Cognome |Email               |Telefono   |DataReg   |Codice|Creazio
ne |
\end_layout

\begin_layout Plain Layout

+--+--------+--------+--------------------+-----------+----------+------+-------
---+
\end_layout

\begin_layout Plain Layout

|20|Paolo   |Spano   |Spanopaolo@gmail.com|04325689751|2014-06-20|    18|2014-05-
05|
\end_layout

\begin_layout Plain Layout

| 7|Mirco   |Occhio  |Occhi86@alice.it    |0499428713 |2008-05-17|    45|2014-05-
07|
\end_layout

\begin_layout Plain Layout

|15|Michele |Diasio  |Midiasio@yahoo.com  |031565846  |2013-06-14|   138|2014-05-
11|
\end_layout

\begin_layout Plain Layout

| 4|Anna    |Barletta|Banna233@libero.it  |0499978712 |2008-07-13|   180|2014-05-
12|
\end_layout

\begin_layout Plain Layout

| 5|Livia   |Rampolli|LiviaRamp@yahoo.com |0495967498 |2013-05-12|     8|2014-05-
13|
\end_layout

\begin_layout Plain Layout

| 2|Carlo   |Milo    |Cmilo@hotmail.it    |0499765671 |2009-12-19|    11|2014-05-
13|
\end_layout

\begin_layout Plain Layout

|17|Lucrezia|Pivato  |lucrpiv75@hotmail   |0495864251 |2000-11-06|    68|2014-05
-13|
\end_layout

\begin_layout Plain Layout

|13|Matteo  |Legato  |LMatteo@gmail.com   |061254685  |2013-01-28|   105|2014-05-
13|
\end_layout

\begin_layout Plain Layout

|10|Micol   |Davidson|Mdavid87@libero.it  |0491324566 |2007-09-03|    96|2014-05-
13|
\end_layout

\begin_layout Plain Layout

| 5|Livia   |Rampolli|LiviaRamp@yahoo.com |0495967498 |2013-05-12|   159|2014-05-
14|
\end_layout

\begin_layout Plain Layout

+--+--------+--------+--------------------+-----------+----------+------+-------
---+
\end_layout

\begin_layout Plain Layout

10 rows in set (0.01 sec)
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Piatto di costo massimo tra le prenotazioni di costo minimo d'ogni cliente.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "breaklines=true,frame=single,language=SQL"
inline false
status open

\begin_layout Plain Layout

drop view if exists CostoPren;
\end_layout

\begin_layout Plain Layout

create view CostoPren as(
\end_layout

\begin_layout Plain Layout

  select Codice, CodCliente, PrezzoPrenotazione(Codice) as Totale
\end_layout

\begin_layout Plain Layout

  from Prenotazioni
\end_layout

\begin_layout Plain Layout

);
\end_layout

\begin_layout Plain Layout

drop view if exists MinPren;
\end_layout

\begin_layout Plain Layout

	create view MinPren as(
\end_layout

\begin_layout Plain Layout

	select cp.Codice, min(Totale) as MinTot, cp.CodCliente
\end_layout

\begin_layout Plain Layout

	from CostoPren cp
\end_layout

\begin_layout Plain Layout

	group by cp.CodCliente
\end_layout

\begin_layout Plain Layout

);
\end_layout

\begin_layout Plain Layout

select c.Nome as NomeC, c.Cognome ,mp.MinTot as 'MinPren(E)', max(p.costo) as
 'MaxPiat(E)', p.Nome as NomeP, p.Costo
\end_layout

\begin_layout Plain Layout

from MinPren mp join PrenotazioniPiatti pp on mp.Codice=pp.CodPrenotazione
 natural join Piatti p join Clienti c on mp.CodCliente=c.Id
\end_layout

\begin_layout Plain Layout

group by mp.Codice;
\end_layout

\end_inset

Output (i nomi dei piatti sono stati troncati):
\begin_inset listings
lstparams "basicstyle={\tiny}"
inline false
status open

\begin_layout Plain Layout

+---------+---------+----------+----------+-------------------------------------
--------------+-----+
\end_layout

\begin_layout Plain Layout

|NomeC    |Cognome  |MinPren(E)|MaxPiat(E)|NomeP                       
                       |Costo|
\end_layout

\begin_layout Plain Layout

+---------+---------+----------+----------+-------------------------------------
--------------+-----+
\end_layout

\begin_layout Plain Layout

|Federico |Scrivani |      4.00|      9.00|Clafoutis di carciofi         
                     | 8.00|
\end_layout

\begin_layout Plain Layout

|Carlo    |Milo     |      2.60|     12.00|Declinazioni di cioccolato.
 Torta di mandorle e cio|12.00|
\end_layout

\begin_layout Plain Layout

|Anna     |Barletta |      6.00|     10.00|Pate' di fegatini, fatto in casa,
 con crostini     |10.00|
\end_layout

\begin_layout Plain Layout

|Lucrezia |Pivato   |      7.50|     13.00|Indivia brasata, bagna caoda gentile
 e foglie di pa| 9.00|
\end_layout

\begin_layout Plain Layout

|Fabio    |Moro     |      8.00|     18.00|Casarecce con zucca, gorgonzola,
 semi di zucca e pa|12.00|
\end_layout

\begin_layout Plain Layout

|Tommaso  |Galeni   |     10.00|     10.00|Insalatina con uva, noci, melograno
 ed anatra marin|10.00|
\end_layout

\begin_layout Plain Layout

|Micol    |Davidson |      2.00|      1.00|Caffe'                        
                     | 1.00|
\end_layout

\begin_layout Plain Layout

|Livia    |Rampolli |      1.00|     16.00|Pollo piccante con salsa Tandoori
 e tortino di riso|16.00|
\end_layout

\begin_layout Plain Layout

|Francesco|DeAngelis|      7.00|      8.00|Clafoutis di carciofi         
                     | 8.00|
\end_layout

\begin_layout Plain Layout

|Paolo    |Grano    |      4.50|     18.00|Linguine con ragu' di mare (pescato
 del giorno e sa|13.00|
\end_layout

\begin_layout Plain Layout

|Michele  |Diasio   |      2.00|     16.00|Pollo piccante con salsa Tandoori
 e tortino di riso|16.00|
\end_layout

\begin_layout Plain Layout

|Moira    |Orfei    |      6.10|     13.00|Clafoutis di carciofi         
                     | 8.00|
\end_layout

\begin_layout Plain Layout

|Paolo    |Spano    |     16.00|     12.00|Casarecce con zucca, gorgonzola,
 semi di zucca e pa|12.00|
\end_layout

\begin_layout Plain Layout

|Gianna   |Missis   |      6.00|     16.00|Spaghetti con pancetta e fonduta
 di Reggiano allo Z|13.00|
\end_layout

\begin_layout Plain Layout

|Matteo   |Legato   |     13.00|     13.00|Stracciatella di bufala, pomodori
 alla Provenzale e|10.00|
\end_layout

\begin_layout Plain Layout

|Mirco    |Occhio   |      4.00|     12.00|Vellutata di zucca, rape bianche
 e porri           | 9.00|
\end_layout

\begin_layout Plain Layout

|Mattia   |Patti    |     12.00|     18.00|Pollo piccante con salsa Tandoori
 e tortino di riso|16.00|
\end_layout

\begin_layout Plain Layout

|Lucia    |Felice   |     12.00|      9.00|Indivia brasata, bagna caoda gentile
 e foglie di pa| 9.00|
\end_layout

\begin_layout Plain Layout

|Pietro   |Gabelli  |      3.00|      5.00|Birra 0.4 lt                   
                    | 5.00|
\end_layout

\begin_layout Plain Layout

|Matteo   |Moccoli  |     24.00|     16.00|Straccetti di grano duro con broccolo
 al vino e sal|12.00|
\end_layout

\begin_layout Plain Layout

+---------+---------+----------+----------+-------------------------------------
--------------+-----+
\end_layout

\begin_layout Plain Layout

20 rows in set (0.06 sec)
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Nome dei clienti che hanno cenato al ristorante lo stesso giorno dell'anno
 in cui hanno effettuato l'iscrizione.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "breaklines=true,frame=single,language=SQL"
inline false
status open

\begin_layout Plain Layout

drop view if exists PrenGM;
\end_layout

\begin_layout Plain Layout

create view PrenGM as(
\end_layout

\begin_layout Plain Layout

  select p.Codice, p.CodCliente, day(p.DataPren) as Giorno, month(p.DataPren)
 as Mese, DataPren
\end_layout

\begin_layout Plain Layout

  from Prenotazioni p natural join Ricevute
\end_layout

\begin_layout Plain Layout

);
\end_layout

\begin_layout Plain Layout

drop view if exists ClGM;
\end_layout

\begin_layout Plain Layout

create view ClGM as(
\end_layout

\begin_layout Plain Layout

  select Id, Nome, Cognome, day(DataReg) as Giorno, month(DataReg) as Mese,
 DataReg
\end_layout

\begin_layout Plain Layout

  from Clienti 
\end_layout

\begin_layout Plain Layout

);
\end_layout

\begin_layout Plain Layout

select c.Id, c.Nome, c.Cognome, c.DataReg, pg.Codice as CodPren, pg.DataPren
\end_layout

\begin_layout Plain Layout

from ClGM c join PrenGM pg on c.Id=pg.CodCliente
\end_layout

\begin_layout Plain Layout

where c.Mese=pg.Mese and c.Giorno=pg.Giorno;
\end_layout

\end_inset

Output:
\begin_inset listings
lstparams "basicstyle={\scriptsize}"
inline false
status open

\begin_layout Plain Layout

+----+------+----------+------------+---------+------------+
\end_layout

\begin_layout Plain Layout

| Id | Nome | Cognome  | DataReg    | CodPren | DataPren   |
\end_layout

\begin_layout Plain Layout

+----+------+----------+------------+---------+------------+
\end_layout

\begin_layout Plain Layout

|  4 | Anna | Barletta | 2008-07-13 |      28 | 2014-07-13 |
\end_layout

\begin_layout Plain Layout

+----+------+----------+------------+---------+------------+
\end_layout

\begin_layout Plain Layout

1 row in set (0.00 sec)
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Clienti che hanno ordinato bevande per una cifra superiore alla somma del
 totale relativo alle pietanze, in prenotazioni con più di 4 porzioni in
 cui sono stati utilizzati più di 10 punti.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "breaklines=true,frame=single,language=SQL"
inline false
status open

\begin_layout Plain Layout

-- Clienti che hanno ordinato bevande per una cifra superiore alla somma
 del totale delle pietanze in prenotazioni
\end_layout

\begin_layout Plain Layout

drop view if exists PrenB;
\end_layout

\begin_layout Plain Layout

create view PrenB as
\end_layout

\begin_layout Plain Layout

  select pp.CodPrenotazione, sum(pp.Nporzioni*p.Costo) as TBev
\end_layout

\begin_layout Plain Layout

  from PrenotazioniPiatti pp join Bevande b on pp.CodPiatto=b.Codice natural
 join Piatti p
\end_layout

\begin_layout Plain Layout

  group by pp.CodPrenotazione
\end_layout

\begin_layout Plain Layout

  union
\end_layout

\begin_layout Plain Layout

	  select distinct pp.CodPrenotazione, 0.00 as TBev
\end_layout

\begin_layout Plain Layout

	  from PrenotazioniPiatti pp where pp.CodPrenotazione not in 
\end_layout

\begin_layout Plain Layout

	    (select distinct p.CodPrenotazione from PrenotazioniPiatti p join Bevande
 b on p.CodPiatto=b.Codice)
\end_layout

\begin_layout Plain Layout

  order by CodPrenotazione;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

drop view if exists Temp;
\end_layout

\begin_layout Plain Layout

create view Temp as
\end_layout

\begin_layout Plain Layout

select pp.CodPrenotazione, sum(pp.Nporzioni*p.Costo) as TCib
\end_layout

\begin_layout Plain Layout

from PrenotazioniPiatti pp natural join Piatti p
\end_layout

\begin_layout Plain Layout

where not exists(
\end_layout

\begin_layout Plain Layout

  select *
\end_layout

\begin_layout Plain Layout

  from Bevande b 
\end_layout

\begin_layout Plain Layout

  where pp.CodPiatto=b.Codice)
\end_layout

\begin_layout Plain Layout

group by pp.CodPrenotazione;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

drop view if exists PrenC;
\end_layout

\begin_layout Plain Layout

create view PrenC as
\end_layout

\begin_layout Plain Layout

  select CodPrenotazione, TCib 
\end_layout

\begin_layout Plain Layout

  from Temp
\end_layout

\begin_layout Plain Layout

  union 
\end_layout

\begin_layout Plain Layout

  select distinct pp.CodPrenotazione as CodPrenotazione, 0.00 as TCib
\end_layout

\begin_layout Plain Layout

  from PrenotazioniPiatti pp where pp.CodPrenotazione not in 
\end_layout

\begin_layout Plain Layout

    (select distinct pp.CodPrenotazione from Temp);
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

select cl.Id,cl.Nome,cl.Cognome, b.Tbev as TotBevande, c.TCib as TotNonBevande
\end_layout

\begin_layout Plain Layout

from PrenB b natural join PrenC c join Prenotazioni p on b.CodPrenotazione=p.Codic
e join Clienti cl on p.CodCliente=cl.Id
\end_layout

\begin_layout Plain Layout

where b.Tbev > c.Tcib;
\end_layout

\end_inset

Output:
\begin_inset listings
lstparams "basicstyle={\scriptsize}"
inline false
status open

\begin_layout Plain Layout

+----+----------+----------+------------+---------------+
\end_layout

\begin_layout Plain Layout

| Id | Nome     | Cognome  | TotBevande | TotNonBevande |
\end_layout

\begin_layout Plain Layout

+----+----------+----------+------------+---------------+
\end_layout

\begin_layout Plain Layout

| 14 | Federico | Scrivani |      10.50 |         10.00 |
\end_layout

\begin_layout Plain Layout

+----+----------+----------+------------+---------------+
\end_layout

\begin_layout Plain Layout

1 row in set (0.08 sec)
\end_layout

\end_inset


\end_layout

\begin_layout Section
Interfaccia 
\shape italic
web
\end_layout

\begin_layout Standard
L'interfaccia è costituita pagine di interfaccia ed una libreria comune
 a tutte le pagine.
\end_layout

\begin_layout Standard
La libreria raccoglie tutte le funzioni utilizzate dalle pagine; i parametri
 vengono scambiano parametri quasi esclusivamente attraverso il metodo POST,
 compiono operazioni sulla base di dati e mostrano il risultato nella pagina
 web visibile all'utente.
\end_layout

\begin_layout Standard
Lo schema del sito prevede che dalla home l'utente non registrato abbia
 modo di leggere il menù del ristorante e consultare gli orari d'apertura.
 Una volta registrato, oltre a quelle operazioni, può consultare le prenotazioni
 che ha effettuate, crearne di nuove, controllare i punti della sua carta
 fedeltà, ed aggiornare i dati personali e la password.
 Tutte queste operazioni si trovano nella pagina cui l'utente arriva dopo
 aver effettuato l'accesso.
\end_layout

\begin_layout Standard
L'utente che è anche gestore ha ancora a disposizione le operazioni descritte
 fin'ora, ma ne ha anche altre: può controllare le prenotazioni della sera
 corrente o su date specifiche, modificare il menù del ristorante, eliminare
 utenti del sito e visionare gli accessi, aggiungere membri del personale,
 emettere ricevute, consultare l'elenco delle ricevte emesse ed aggiungere
 prenotazioni a nome di clienti specifici.
\end_layout

\begin_layout Subsection
Libreria
\end_layout

\begin_layout Subsubsection
libreria.php
\end_layout

\begin_layout Standard
Questo file contiene tutte le funzioni utilizzate.
 Sono presenti:
\end_layout

\begin_layout Itemize
Funzioni generali per la creazione di pagine html:
\end_layout

\begin_deeper
\begin_layout Itemize
page_start($title) manda in output l'intestazione della pagina, con titolo
 $title; viene usata per le pagine che vengono generate da chi non ha ancora
 effettuato l'accesso.
\end_layout

\begin_layout Itemize
inizio_pagina($title): simile alla precedente, ma genera anche un header
 contenente un messaggio di benvenuto personalizzato col nome dell'utente.
\end_layout

\begin_layout Itemize
page_end(): chiude i tag aperti dalle funzioni precedenti.
\end_layout

\begin_layout Itemize
subtitle($str): stampa il contenuto di $str come un sottotitolo all'interno
 della pagina.
\end_layout

\begin_layout Itemize
back($url): crea un link alla pagina $url, assieme ad un messaggio d'avviso.
\end_layout

\begin_layout Itemize
Lk($pg, $info): simile alla precedente, la differenza è che il messaggio
 d'avviso è contenuto all'interno di $info.
\end_layout

\begin_layout Itemize
Ul_start(): genera l'inizio d'un nuovo elenco puntato.
\end_layout

\begin_layout Itemize
Ul_end(): il contrario della funzione precedente.
\end_layout

\begin_layout Itemize
Pt($l, $t): genera un punto d'un elenco come link alla pagina $l avente
 come testo $t.
\end_layout

\begin_layout Itemize
pt_i($l, $info,$t): genera un punto di elenco puntato come collegamento
 alla pagina $l che riceve nel parametro B1il valore contenuto in $info;
 viene mostrato come testo nel collegamento il contenuto di $t.
\end_layout

\begin_layout Itemize
Point($info): funzione che genera un punto di una lista.
\end_layout

\begin_layout Itemize
back_home(): genera un collegamento alla pagina home.php.
\end_layout

\end_deeper
\begin_layout Itemize
Funzioni per la generazione di tabelle:
\end_layout

\begin_deeper
\begin_layout Itemize
table_start($head): genera l'inizio di una tabella avente come header il
 contenuto di $head.
\end_layout

\begin_layout Itemize
table_start_NH(): come la precedente, ma senza l'header.
\end_layout

\begin_layout Itemize
echo_row($row): crea un nuova riga all'interno della tabella con il contenuto
 della riga $row.
\end_layout

\begin_layout Itemize
echo_row_RDB($row): simile alla precedente, ma crea un'ulteriore cella contenent
e un radio button.
\end_layout

\begin_layout Itemize
echo_row_CK($row): simile alla precedente, ma crea un'ulteriore cella contenente
 un radio check box.
\end_layout

\begin_layout Itemize
table_end(): genera il tag di chiusura d'una tabella.
\end_layout

\end_deeper
\begin_layout Itemize
Funzioni per la generazione di form:
\end_layout

\begin_deeper
\begin_layout Itemize
form-start($type, $dest): crea l'inizio di una nuova form, che passa i parametri
 tramite il metodo $type, alla pagina $dest.
\end_layout

\begin_layout Itemize
form_end(): genera i pulsanti 
\begin_inset Quotes eld
\end_inset

Procedi
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

Cancella
\begin_inset Quotes erd
\end_inset

 e chiude i tag aperti dalla funzione precedente.
\end_layout

\end_deeper
\begin_layout Itemize
Funzioni per la connessione al database ed autenticazione:
\end_layout

\begin_deeper
\begin_layout Itemize
dbConnect(): crea una connessione al database e la associa al parametro
 restituito per valore.
\end_layout

\begin_layout Itemize
get_pwd($login): data una login contenuta in $login viene restituita la
 password di quell'utente, se presente; altrimenti viene restituito FALSE.
\end_layout

\begin_layout Itemize
authenticate(): inizia la sessione e verifica che l'utente sia autenticato.
\end_layout

\end_deeper
\begin_layout Itemize
Funzioni per l'accesso al menù:
\end_layout

\begin_deeper
\begin_layout Itemize
vis_menu(): genera un elenco puntato fatto di collegamenti alla pagina result.php
 che riceve un valore tramite GET.
 Ognuno di questi collegamenti passa un numero diverso all'interno del parametro
: 0 per vedere l'intero menù, 1 per gli antipasti, 2 per i primi, 3 per
 i secondi e così via.
\end_layout

\begin_layout Itemize
result($conn, $i): crea una tabella con tutti i piatti di tipo $i che sono
 stati passati premendo sui collegamenti generati dalla funzione precedente.
\end_layout

\begin_layout Itemize
menu($conn): chiama la funzione precedente per ogni tipo di piatto presente
 nel menù.
\end_layout

\end_deeper
\begin_layout Itemize
Funzioni di utilità:
\end_layout

\begin_deeper
\begin_layout Itemize
chkEmail($email): fa un controllo sull'indirizzo mail inserito, restituendo
 true o false a seconda del caso.
\end_layout

\begin_layout Itemize
new_Client($nome, $cognome, $mail, $telefono): chiede al database la data
 corrente ed il numero di clienti inseriti e memorizza un nuovo cliente
 avente Id pari all'intero successivo, gli altri campi pari a quelli passati
 alla funzione e la data di registrazione pari a quella restituita dal database.
 Infine restituisce l'Id del cliente appena inserito.
\end_layout

\begin_layout Itemize
new user($n_ut, $login, $password): memorizza un nuovo utente con i campi
 che sono passati.
\end_layout

\begin_layout Itemize
creapren($Id, $dataP, $num): simile a new_Client, interroga il database
 per sapere quante prenotazioni sono presenti e la data corrente, infine
 inserisce una nuova prenotazione con Codice pari all'intero successivo
 del numero di prenotazioni correnti, come parametri quelli che vengono
 passati e come data quella che ha ricevuto dal database.
 Infine restituisce il Codice della prenotazione.
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\footnotesize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

  <?php
\end_layout

\begin_layout Plain Layout

  /***************************************************/
\end_layout

\begin_layout Plain Layout

  /*FUNZIONI GENERALI PER LA CREAZIONE DI PAGINE HTML*/
\end_layout

\begin_layout Plain Layout

  /***************************************************/
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  //funzione che crea l'inizio di una pagina web, con $title come titolo
\end_layout

\begin_layout Plain Layout

    function page_start($title){
\end_layout

\begin_layout Plain Layout

    echo<<<END
\end_layout

\begin_layout Plain Layout

    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/
xhtml1/DTD/xhtml1-strict.dtd">
\end_layout

\begin_layout Plain Layout

    <html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="it" lang="it">
\end_layout

\begin_layout Plain Layout

      <html><head><title>$title</title></head><body bgcolor="#F0E0B2">
\end_layout

\begin_layout Plain Layout

      <h1 align='center'><i>$title</i></h1>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  //funzione che crea l'inizio di una pagina web, con $title come titolo
 
\end_layout

\begin_layout Plain Layout

  function inizio_pagina($title){
\end_layout

\begin_layout Plain Layout

    echo<<<END
\end_layout

\begin_layout Plain Layout

    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/
xhtml1/DTD/xhtml1-strict.dtd">
\end_layout

\begin_layout Plain Layout

    <html xmlns="http://www.w3.org/1999/xhtml"  xml:lang="it" lang="it">
\end_layout

\begin_layout Plain Layout

    <head><title>"Ma certo - Ristorante"</title></head><body bgcolor="#F0E0B2">
\end_layout

\begin_layout Plain Layout

    <h1 align='center'><i>$title</i></h1>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

    echo"<div id='header'>";
\end_layout

\begin_layout Plain Layout

    echo"<table border='0' bgcolor='#FFFF66' cellpadding='10' align='center'
 height='42'><frameset>";
\end_layout

\begin_layout Plain Layout

    echo"<tr><td width='1600' align='right' >Benvenuto <b> ".$_SESSION['nome']."
 </b>";
\end_layout

\begin_layout Plain Layout

    Lk("logout.php","Logout");
\end_layout

\begin_layout Plain Layout

    echo"</td></tr></frameset></table>";
\end_layout

\begin_layout Plain Layout

    echo"</div>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

    function subtitle($str){
\end_layout

\begin_layout Plain Layout

      echo"<h3>$str</h3>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    function back($url){
\end_layout

\begin_layout Plain Layout

      echo"<p><a href=$url>Torna alla pagina <b><i>$url</i></b></a></p>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

   //funzione che crea il link alla pagina $pg, passando col metodo get
 nel parametro $bg l'informazione contenuta nel campo $info 
\end_layout

\begin_layout Plain Layout

    function Lk($pg,$info){
\end_layout

\begin_layout Plain Layout

      echo"<td><a href=".$pg."?B1=".$info."><b><i>$info</i></b></a></td>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

   //funzione che genera un punto d'un elenco puntato come link alla pagina
 $l visualizzando il testo in $t
\end_layout

\begin_layout Plain Layout

    function Pt($l, $t){
\end_layout

\begin_layout Plain Layout

      echo"<li><a href=".$l.">$t</a></li>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

   //funzione che genera un punto d'un elenco puntato come link alla pagina
 $l visualizzando il testo in $t
\end_layout

\begin_layout Plain Layout

    function pt_i($l, $info, $t){
\end_layout

\begin_layout Plain Layout

      echo"<li><a href=".$l."?B1=".$info.">$t</a></li>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

   //funzione genera l'apertura d'un nuovo elenco puntato
\end_layout

\begin_layout Plain Layout

    function Ul_start(){
\end_layout

\begin_layout Plain Layout

      echo"<ul>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

   //funzione genera la chiusura di un elenco puntato
\end_layout

\begin_layout Plain Layout

    function Ul_end(){
\end_layout

\begin_layout Plain Layout

      echo"</ul>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

   //funzione che conclude una pagina html 
\end_layout

\begin_layout Plain Layout

    function page_end(){
\end_layout

\begin_layout Plain Layout

      echo"</body></html>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

   //funzione che genera il punto di una lista 
\end_layout

\begin_layout Plain Layout

    function Point($info){
\end_layout

\begin_layout Plain Layout

      echo"<li>$info</li>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    function back_home(){back("home.php");};
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    /**************************************/
\end_layout

\begin_layout Plain Layout

    /*FUNZIONI PER LA CREAZIONE DI TABELLE*/
\end_layout

\begin_layout Plain Layout

    /**************************************/
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

   //funzione che genera l'inizio d'una tabella avente come header il contenuto
 di $head
\end_layout

\begin_layout Plain Layout

    function table_start($head){
\end_layout

\begin_layout Plain Layout

      echo"<table align='center' border='1'><tr>";
\end_layout

\begin_layout Plain Layout

      foreach($head as $value){
\end_layout

\begin_layout Plain Layout

	echo"<th>$value</th>";
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      echo"</tr>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    function table_start_NH(){
\end_layout

\begin_layout Plain Layout

      echo"<table align='center' border='1'>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

   //funzione che stampa la riga $row
\end_layout

\begin_layout Plain Layout

    function echo_row($row) {
\end_layout

\begin_layout Plain Layout

      echo"<tr>";
\end_layout

\begin_layout Plain Layout

      foreach ($row as $field)
\end_layout

\begin_layout Plain Layout

	echo"<td>$field</td>";
\end_layout

\begin_layout Plain Layout

      echo"</tr>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

	function echo_row_RDB($row) {
\end_layout

\begin_layout Plain Layout

      echo"<tr>";
\end_layout

\begin_layout Plain Layout

      foreach ($row as $field)
\end_layout

\begin_layout Plain Layout

	echo"<td>$field</td>";
\end_layout

\begin_layout Plain Layout

      echo"<td align='center'><input type='radio' name='B1' value=$row[Codice]><
/td>";
\end_layout

\begin_layout Plain Layout

      echo"</tr>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	function echo_row_CK($row) {
\end_layout

\begin_layout Plain Layout

      echo"<tr>";
\end_layout

\begin_layout Plain Layout

      foreach ($row as $field)
\end_layout

\begin_layout Plain Layout

		echo"<td>$field</td>";
\end_layout

\begin_layout Plain Layout

      echo"<td><input type='checkbox' name='Ids[]' value=$row[Id]></td>";
\end_layout

\begin_layout Plain Layout

      echo"</tr>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    function table_end(){
\end_layout

\begin_layout Plain Layout

      echo"</table>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    /*funzione per la genrazione di form*/
\end_layout

\begin_layout Plain Layout

    function form_start($type, $dest){
\end_layout

\begin_layout Plain Layout

      echo"<form method='$type' action='$dest' border='0'>";
\end_layout

\begin_layout Plain Layout

      echo"<fieldset style='border:none'>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

   //funzione per la chiusura d'una form 
\end_layout

\begin_layout Plain Layout

    function form_end(){
\end_layout

\begin_layout Plain Layout

      echo"<input type='submit' name='submit' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

      echo"<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

      echo"</fieldset>";
\end_layout

\begin_layout Plain Layout

      echo"</form>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  /*****************************************/
\end_layout

\begin_layout Plain Layout

  /*FUNZIONE PER LA CONNESSIONE AL DATABASE*/
\end_layout

\begin_layout Plain Layout

  /*****************************************/
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  function dbConnect() {
\end_layout

\begin_layout Plain Layout

    $server="basidati";
\end_layout

\begin_layout Plain Layout

    $username="pgabelli";
\end_layout

\begin_layout Plain Layout

    $password="L4t7t9LX";
\end_layout

\begin_layout Plain Layout

    $dbname="pgabelli-PR";
\end_layout

\begin_layout Plain Layout

    $conn=mysql_connect($server,$username,$password)
\end_layout

\begin_layout Plain Layout

      or die("Impossibile effettuare la connessione");
\end_layout

\begin_layout Plain Layout

    mysql_select_db($dbname,$conn);
\end_layout

\begin_layout Plain Layout

    return $conn;
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  /*********************************/
\end_layout

\begin_layout Plain Layout

  /* FUNZIONI PER L'AUTENTICAZIONE */
\end_layout

\begin_layout Plain Layout

  /*********************************/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  function get_pwd($login) {
\end_layout

\begin_layout Plain Layout

    $conn = dbConnect();
\end_layout

\begin_layout Plain Layout

    $query= "SELECT * FROM Utenti WHERE Login='$login'";
\end_layout

\begin_layout Plain Layout

    $result=mysql_query($query,$conn)
\end_layout

\begin_layout Plain Layout

      or die("Query fallita" .
 mysql_error($conn));
\end_layout

\begin_layout Plain Layout

    $output=mysql_fetch_assoc($result);
\end_layout

\begin_layout Plain Layout

    if ($output)
\end_layout

\begin_layout Plain Layout

      return $output['password'];
\end_layout

\begin_layout Plain Layout

    else 
\end_layout

\begin_layout Plain Layout

      return FALSE;
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  /*inizia la sessione e verifica che l'utente sia autenticato */
\end_layout

\begin_layout Plain Layout

  function authenticate() {
\end_layout

\begin_layout Plain Layout

    session_start();
\end_layout

\begin_layout Plain Layout

    if(isset($_SESSION['logged'])){
\end_layout

\begin_layout Plain Layout

      $login=$_SESSION['logged'];
\end_layout

\begin_layout Plain Layout

      if (isset($login)) {
\end_layout

\begin_layout Plain Layout

      return $login;
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    return FALSE;  
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  /********************************/
\end_layout

\begin_layout Plain Layout

  /*FUNZIONI PER L'ACCESSO AL MENÙ*/
\end_layout

\begin_layout Plain Layout

  /********************************/
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  function vis_menu(){
\end_layout

\begin_layout Plain Layout

    pt_i("risultato.php","0","Guarda tutto il menu`");
\end_layout

\begin_layout Plain Layout

    Ul_start();
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","1","Antipasti");
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","2","Primi");
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","3","Secondi");
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","4","Contorni");
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","5","Dolci");
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","6","Piatti speciali");
\end_layout

\begin_layout Plain Layout

      pt_i("risultato.php","7","Bibite");
\end_layout

\begin_layout Plain Layout

    Ul_end();
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  function result($conn,$i){
\end_layout

\begin_layout Plain Layout

    $h=array("Menu","Antipasti","Primi","Secondi","Contorni","Dolci","PiattiSpec
iali","Bevande");
\end_layout

\begin_layout Plain Layout

    $s=array("Menu","Antipasti","Primi","Secondi","Contorni","Dolci","Piatti
 Speciali","Bevande");
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    $j=$s[$i];
\end_layout

\begin_layout Plain Layout

    echo"<h3><h3 align='center'>$j</h3>";
\end_layout

\begin_layout Plain Layout

    $q=$h[$i];
\end_layout

\begin_layout Plain Layout

    $result=mysql_query("Select p.Nome, p.Costo from Piatti p join $q q on
 p.CodPiatto=q.Codice",$conn)
\end_layout

\begin_layout Plain Layout

    or die("Query fallita");
\end_layout

\begin_layout Plain Layout

    $head=array("Nome","Costo");
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($result);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<p align='center'>Non ci sono ".$s[$i]."</p>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      table_start_NH($head);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($result))
\end_layout

\begin_layout Plain Layout

	echo"<tr><td>".$row["Nome"]."</td><td>".number_format($row["Costo"],2)."€</td></tr>
";
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    echo"<BR";
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  function menu($conn){
\end_layout

\begin_layout Plain Layout

    result($conn,1);
\end_layout

\begin_layout Plain Layout

    result($conn,2);
\end_layout

\begin_layout Plain Layout

    result($conn,3);
\end_layout

\begin_layout Plain Layout

    result($conn,4);
\end_layout

\begin_layout Plain Layout

    result($conn,5);
\end_layout

\begin_layout Plain Layout

    result($conn,6);
\end_layout

\begin_layout Plain Layout

    result($conn,7);
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  /*********************/
\end_layout

\begin_layout Plain Layout

  /*FUNZIONI DI UTILITÀ*/
\end_layout

\begin_layout Plain Layout

  /*********************/
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  function chkEmail($email){
\end_layout

\begin_layout Plain Layout

    $email = trim($email);
\end_layout

\begin_layout Plain Layout

    // se la stringa è vuota sicuramente non è una mail
\end_layout

\begin_layout Plain Layout

    if(!$email) {
\end_layout

\begin_layout Plain Layout

      return false;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    // controllo che ci sia una sola @ nella stringa
\end_layout

\begin_layout Plain Layout

    $num_at = count(explode( '@', $email )) - 1;
\end_layout

\begin_layout Plain Layout

    if($num_at != 1) {
\end_layout

\begin_layout Plain Layout

      return false;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    // controllo la presenza di ulteriori caratteri "pericolosi":
\end_layout

\begin_layout Plain Layout

    if(strpos($email,';') || strpos($email,',') || strpos($email,' ')) {
\end_layout

\begin_layout Plain Layout

      return false;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    // la stringa rispetta il formato classico di una mail?
\end_layout

\begin_layout Plain Layout

    if(!preg_match( '/^[
\backslash
w
\backslash
.
\backslash
-]+@
\backslash
w+[
\backslash
w
\backslash
.
\backslash
-]*?
\backslash
.
\backslash
w{1,4}$/', $email)) {
\end_layout

\begin_layout Plain Layout

      return false;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    return true;
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  function new_Client($nome, $cognome,$mail,$telefono) {
\end_layout

\begin_layout Plain Layout

      /* si connette e seleziona il database da usare */
\end_layout

\begin_layout Plain Layout

      $conn = dbConnect();
\end_layout

\begin_layout Plain Layout

      $row=mysql_fetch_array(mysql_query("select count(*) from Clienti",
 $conn));
\end_layout

\begin_layout Plain Layout

      if( $row[0] == 0)
\end_layout

\begin_layout Plain Layout

	$n_ut=0;
\end_layout

\begin_layout Plain Layout

      else {
\end_layout

\begin_layout Plain Layout

	$row=mysql_fetch_array(mysql_query("select max(u.Id) from Clienti u", $conn));
\end_layout

\begin_layout Plain Layout

	$n_ut=$row[0];
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      $n_ut++;
\end_layout

\begin_layout Plain Layout

      $ardate=mysql_fetch_array(mysql_query("select curdate()",$conn));
\end_layout

\begin_layout Plain Layout

      $date=$ardate[0];
\end_layout

\begin_layout Plain Layout

      $query="INSERT INTO Clienti VALUES ('$n_ut', '$nome', '$cognome','$mail','
$telefono','$date')";
\end_layout

\begin_layout Plain Layout

      mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

      return $n_ut;
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  function new_user($n_ut,$login, $password) {
\end_layout

\begin_layout Plain Layout

    /* si connette e seleziona il database da usare */
\end_layout

\begin_layout Plain Layout

    $conn = dbConnect();
\end_layout

\begin_layout Plain Layout

    /* preparazione dello statement */
\end_layout

\begin_layout Plain Layout

    $s=SHA1($password);
\end_layout

\begin_layout Plain Layout

    $query="INSERT INTO Utenti VALUES ('$n_ut', '$login', '$s','1')";
\end_layout

\begin_layout Plain Layout

    $result=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    return $result;
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  function creapren($Id, $dataP, $num){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    $ardate=mysql_fetch_array(mysql_query("select curdate()",$conn));
\end_layout

\begin_layout Plain Layout

    $dt=$ardate[0];
\end_layout

\begin_layout Plain Layout

    $arpren=mysql_fetch_array(mysql_query("select max(Codice) from Prenotazioni"
,$conn));
\end_layout

\begin_layout Plain Layout

    $np=1+$arpren[0];
\end_layout

\begin_layout Plain Layout

     $query="insert into Prenotazioni values('$np', '$dt', '$dataP', '$num',
 '$Id')";
\end_layout

\begin_layout Plain Layout

     mysql_query($query,$conn) or $err="errore nell'inserimento della prenotazio
ne";
\end_layout

\begin_layout Plain Layout

    return $np;
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Pagine di interfaccia
\end_layout

\begin_layout Subsubsection
home.php
\end_layout

\begin_layout Standard
La home contiene il form per fare il login, ed il collegamento alle pagine
 che mostrano informazioni generali sul ristorante, quali menù ed orari.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  /* se l'utente e` gia` autenticato, va direttamente alla pagina delle
 operazioni.php*/
\end_layout

\begin_layout Plain Layout

$login=authenticate();
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

  header("Location: operazioni.php");
\end_layout

\begin_layout Plain Layout

else{
\end_layout

\begin_layout Plain Layout

  page_start("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

  echo<<<END
\end_layout

\begin_layout Plain Layout

  <form method="post" syle="border=none" action="logcheck.php"> 
\end_layout

\begin_layout Plain Layout

    <table border="0" bgcolor="#FFFF66" align="center">
\end_layout

\begin_layout Plain Layout

    <tr><td width="1600" align="right">
\end_layout

\begin_layout Plain Layout

      <fieldset syle="border=none">
\end_layout

\begin_layout Plain Layout

      Nome: <input type="text" name="login">
\end_layout

\begin_layout Plain Layout

      Password: <input type="password" name="pwd">
\end_layout

\begin_layout Plain Layout

      <input type="submit" name="submit" vhtmlalue="Entra">
\end_layout

\begin_layout Plain Layout

      <input type="reset" value="Cancella">
\end_layout

\begin_layout Plain Layout

      <A HREF="registrazione.php"><b>      Registrati</b></A>
\end_layout

\begin_layout Plain Layout

      </fieldset>
\end_layout

\begin_layout Plain Layout

    </form>
\end_layout

\begin_layout Plain Layout

  </td></tr></table>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

  table_start_NH("");
\end_layout

\begin_layout Plain Layout

    echo"<tr>";
\end_layout

\begin_layout Plain Layout

      echo"<td width='250'>";
\end_layout

\begin_layout Plain Layout

	Ul_start();
\end_layout

\begin_layout Plain Layout

	  vis_menu();
\end_layout

\begin_layout Plain Layout

	  Pt("orari.php","Guarda gli orari");
\end_layout

\begin_layout Plain Layout

	Ul_end();
\end_layout

\begin_layout Plain Layout

      echo<<<END
\end_layout

\begin_layout Plain Layout

      </td>
\end_layout

\begin_layout Plain Layout

      <td>
\end_layout

\begin_layout Plain Layout

		<img align="right" width="500" height="500" alt="Esempio di piatto" src="plate.
jpg" />
\end_layout

\begin_layout Plain Layout

      </td>
\end_layout

\begin_layout Plain Layout

    </tr>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

  table_end();
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
logcheck.php
\end_layout

\begin_layout Standard
La pagina logcheck.php fa il controllo sulle credenziali di login che riceve;
 nel caso in cui queste non fossero valide mostra i messaggi d'errore, altriment
i imposta le variabili di sessione.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  /* verifica se sono stati immessi dei dati di login e se sono corretti
 */
\end_layout

\begin_layout Plain Layout

  if(!isset($_POST['login']) || !isset($_POST['pwd'])){
\end_layout

\begin_layout Plain Layout

    $err="Problemi di connessione";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $login=$_POST['login'];
\end_layout

\begin_layout Plain Layout

    $pwd=SHA1($_POST['pwd']);
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    if(isset($login) and $pwd == get_pwd($login)){
\end_layout

\begin_layout Plain Layout

      $ris=mysql_query("select * from Clienti Natural Join Utenti u where
 u.Login='$login'",$conn);
\end_layout

\begin_layout Plain Layout

      $rg=mysql_fetch_assoc($ris);
\end_layout

\begin_layout Plain Layout

      $liv=$rg['livello'];
\end_layout

\begin_layout Plain Layout

      $nome=$rg['Nome'];
\end_layout

\begin_layout Plain Layout

      $id=$rg['Id'];
\end_layout

\begin_layout Plain Layout

      session_start();
\end_layout

\begin_layout Plain Layout

      $_SESSION['logged']=$login;
\end_layout

\begin_layout Plain Layout

      $_SESSION['livello']=$liv;
\end_layout

\begin_layout Plain Layout

      $_SESSION['nome']=$nome;
\end_layout

\begin_layout Plain Layout

      $query="select max(CodLog) from Accessi;";
\end_layout

\begin_layout Plain Layout

      $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

      $v=mysql_fetch_array($ris);
\end_layout

\begin_layout Plain Layout

      $i=$v[0]+1;
\end_layout

\begin_layout Plain Layout

      $ardate=mysql_fetch_array(mysql_query("select curdate()",$conn));
\end_layout

\begin_layout Plain Layout

      $date=$ardate[0];
\end_layout

\begin_layout Plain Layout

      $query="insert into Accessi values('$i','$id','$date')";
\end_layout

\begin_layout Plain Layout

      mysql_query($query, $conn);
\end_layout

\begin_layout Plain Layout

      header("Location: home.php");
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else $err="Nome utente o password errata";
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

  page_start("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\begin_layout Plain Layout

  <form method="post" syle="border=none" action="logcheck.php"> 
\end_layout

\begin_layout Plain Layout

    <table border="0" bgcolor="#FFFF66" align="center">
\end_layout

\begin_layout Plain Layout

    <tr><td width="1600" align="right">
\end_layout

\begin_layout Plain Layout

      <fieldset syle="border=none">
\end_layout

\begin_layout Plain Layout

      Nome: <input type="text" name="login">
\end_layout

\begin_layout Plain Layout

      Password: <input type="password" name="pwd">
\end_layout

\begin_layout Plain Layout

      <input type="submit" name="submit" vhtmlalue="Entra">
\end_layout

\begin_layout Plain Layout

      <input type="reset" value="Cancella">
\end_layout

\begin_layout Plain Layout

      <A HREF="registrazione.php"><b>      Registrati</b></A>
\end_layout

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

    if(isset($err))
\end_layout

\begin_layout Plain Layout

      echo"<BR><b>Errore: $err</b>";
\end_layout

\begin_layout Plain Layout

?> 
\end_layout

\begin_layout Plain Layout

  </fieldset>
\end_layout

\begin_layout Plain Layout

    </form>
\end_layout

\begin_layout Plain Layout

  </td></tr></table>
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  table_start_NH("");
\end_layout

\begin_layout Plain Layout

    echo"<tr>";
\end_layout

\begin_layout Plain Layout

      echo"<td width='250'>";
\end_layout

\begin_layout Plain Layout

	Ul_start();
\end_layout

\begin_layout Plain Layout

	  vis_menu();
\end_layout

\begin_layout Plain Layout

	  Pt("orari.php","Guarda gli orari");
\end_layout

\begin_layout Plain Layout

	Ul_end();
\end_layout

\begin_layout Plain Layout

      echo<<<END
\end_layout

\begin_layout Plain Layout

      </td>
\end_layout

\begin_layout Plain Layout

      <td>
\end_layout

\begin_layout Plain Layout

	<img align="right" width="500" height="500" alt="Esempio di piatto" src="plate.j
pg" />
\end_layout

\begin_layout Plain Layout

      </td>
\end_layout

\begin_layout Plain Layout

    </tr>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

  table_end();
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

  ?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
registrazione.php
\end_layout

\begin_layout Standard
All'interno di questa pagina viene creata la form che permette la registazione
 di un nuovo utente, purché i dati inseriti rispettino alcuni vincoli, quali:
 
\end_layout

\begin_layout Itemize
nome utente, password alfanumerici e non vuoti, nomeutente diverso da quelli
 già presenti, password di almeno 8 caratteri;
\end_layout

\begin_layout Itemize
stringa della password corrispondente alla stringa di controllo;
\end_layout

\begin_layout Itemize
Nome, cognome alfanumerici e non vuoti;
\end_layout

\begin_layout Itemize
Numero di telefono formato da soli numeri, se presente; indirizzo e-mail
 valido, se presente.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

require("libreria.php");
\end_layout

\begin_layout Plain Layout

page_start("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

    //recupera i dati passati nel modulo
\end_layout

\begin_layout Plain Layout

    $nickname = $_POST['nickname'];
\end_layout

\begin_layout Plain Layout

    $password =$_POST['pass1'];
\end_layout

\begin_layout Plain Layout

    $pass1 = $_POST['pass2'];
\end_layout

\begin_layout Plain Layout

    $nome = $_POST['nome'];
\end_layout

\begin_layout Plain Layout

    $cognome= $_POST['cognome'];
\end_layout

\begin_layout Plain Layout

    $email = $_POST['email'];
\end_layout

\begin_layout Plain Layout

    $telefono = $_POST['telefono'];
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    if ( !ctype_alnum($nickname) || !ctype_alnum($password))
\end_layout

\begin_layout Plain Layout

      $err="Login e password devono essere alfanumerici e non vuoti!";
\end_layout

\begin_layout Plain Layout

    elseif ( $password != $pass1 )
\end_layout

\begin_layout Plain Layout

      $err="Le password non corrispondono";
\end_layout

\begin_layout Plain Layout

      elseif(strlen($password)<8)
\end_layout

\begin_layout Plain Layout

	$err="La password dev'essere di almeno 8 caratteri";
\end_layout

\begin_layout Plain Layout

	elseif(get_pwd($nickname))
\end_layout

\begin_layout Plain Layout

	  $err="nickname già utilizzato";
\end_layout

\begin_layout Plain Layout

	  elseif(!ctype_alpha($nome) || !ctype_alpha($cognome))
\end_layout

\begin_layout Plain Layout

	  $err="Nome e cognome devono essere alfanumerici e non vuoti";
\end_layout

\begin_layout Plain Layout

	  else if (isset($email) && ((strlen($telefono)>0) && !chkEmail($email)))
\end_layout

\begin_layout Plain Layout

	    $err="E- mail non valida";
\end_layout

\begin_layout Plain Layout

	    else if (isset($telefono) && ((strlen($telefono)>0) && !is_numeric($telefon
o)))
\end_layout

\begin_layout Plain Layout

	      $err="il telefono deve essere numerico";
\end_layout

\begin_layout Plain Layout

		else{
\end_layout

\begin_layout Plain Layout

		  //Inserisce il nuovo utente nella base di dati
\end_layout

\begin_layout Plain Layout

		  $nickname = mysql_real_escape_string($nickname);
\end_layout

\begin_layout Plain Layout

		  $nome = mysql_real_escape_string($nome);
\end_layout

\begin_layout Plain Layout

		  $cognome = mysql_real_escape_string($cognome);
\end_layout

\begin_layout Plain Layout

		  $email = mysql_real_escape_string($email);
\end_layout

\begin_layout Plain Layout

		  $telefono = mysql_real_escape_string($telefono);
\end_layout

\begin_layout Plain Layout

		  $id=new_Client($nome, $cognome,$email,$telefono);
\end_layout

\begin_layout Plain Layout

		  $r=new_user($id,$nickname, $password);
\end_layout

\begin_layout Plain Layout

		};
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

  table_start_NH("");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\begin_layout Plain Layout

      <tr>
\end_layout

\begin_layout Plain Layout

	<td>
\end_layout

\begin_layout Plain Layout

<?php  
\end_layout

\begin_layout Plain Layout

  if(isset($err) || !isset($_POST['submit'])) {
\end_layout

\begin_layout Plain Layout

?>    
\end_layout

\begin_layout Plain Layout

      <form action="registrazione.php" syle="border=none" method='POST'>
\end_layout

\begin_layout Plain Layout

	<fieldset syle="border=none">
\end_layout

\begin_layout Plain Layout

	  <b>NickName</b>
\end_layout

\begin_layout Plain Layout

	  <input type='text' name='nickname'><br><br>
\end_layout

\begin_layout Plain Layout

	  <b>Password</b>
\end_layout

\begin_layout Plain Layout

	  <input type='password' name='pass1'><br><br>
\end_layout

\begin_layout Plain Layout

	  <b>Ripeti Password</b>
\end_layout

\begin_layout Plain Layout

	  <input type='password' name='pass2'><br><br>
\end_layout

\begin_layout Plain Layout

	  <b>Nome</b>	  
\end_layout

\begin_layout Plain Layout

	  <input type='text' name='nome'><br><br>
\end_layout

\begin_layout Plain Layout

	  <b>Cognome</b>
\end_layout

\begin_layout Plain Layout

	  <input type='text' name='cognome'><br><br>
\end_layout

\begin_layout Plain Layout

	  <b>Telefono</b>
\end_layout

\begin_layout Plain Layout

	  <input type='text' name='telefono' value=""> - campo non obbligatorio
 - <br><br>
\end_layout

\begin_layout Plain Layout

	  <b>Mail</b>
\end_layout

\begin_layout Plain Layout

	  <input type='text' name='email'> - campo non obbligatorio - <br><br>
\end_layout

\begin_layout Plain Layout

	  <input type="reset" name="Cancella tutti i campi">
\end_layout

\begin_layout Plain Layout

	  <input type='submit' name='submit' value='Completa Registrazione'>
\end_layout

\begin_layout Plain Layout

	  <b><a href="home.php"> Torna alla home</a></b>
\end_layout

\begin_layout Plain Layout

	</fieldset>
\end_layout

\begin_layout Plain Layout

      </form>
\end_layout

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

    if(isset($err)){
\end_layout

\begin_layout Plain Layout

      echo"<b>$err</b>";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    //la registrazione è stata effettuata con successo
\end_layout

\begin_layout Plain Layout

    echo "Complimenti, registrazione effettuata con successo.";
\end_layout

\begin_layout Plain Layout

    back("home.php");
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\begin_layout Plain Layout

      </td>
\end_layout

\begin_layout Plain Layout

    </tr>
\end_layout

\begin_layout Plain Layout

    <tr>
\end_layout

\begin_layout Plain Layout

      <td>
\end_layout

\begin_layout Plain Layout

	<img align="center" alt="Esempio sala del Ristorante" src="ristorante-1.jpg"/>
\end_layout

\begin_layout Plain Layout

      </td>
\end_layout

\begin_layout Plain Layout

    </tr>
\end_layout

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

    table_end();
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
operazioni.php
\end_layout

\begin_layout Standard
La pagina operazioni.php fornisce un menù di operazioni differenziato, a
 seconda che la persona che accede sia uno dei gestori oppure no.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  include("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  $title='Ma certo! Ristorante';
\end_layout

\begin_layout Plain Layout

  inizio_pagina($title);
\end_layout

\begin_layout Plain Layout

  echo<<<END
\end_layout

\begin_layout Plain Layout

  <div id="menu" style="position: absolute; float:left; padding: 20px;">
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

  Ul_start();
\end_layout

\begin_layout Plain Layout

    echo"<li><b>Home</b></li>";
\end_layout

\begin_layout Plain Layout

    if($_SESSION['livello']==2)
\end_layout

\begin_layout Plain Layout

    {
\end_layout

\begin_layout Plain Layout

      echo"<li>Operazioni gestore</li>";
\end_layout

\begin_layout Plain Layout

      Ul_start();
\end_layout

\begin_layout Plain Layout

	echo"<li>Visione prenotazioni</li>";
\end_layout

\begin_layout Plain Layout

	Ul_start();
\end_layout

\begin_layout Plain Layout

	  Pt("pren_serata.php", "Sera Corrente");
\end_layout

\begin_layout Plain Layout

	  Pt("pren_scelta.php", "Scelta data");
\end_layout

\begin_layout Plain Layout

	Ul_end();
\end_layout

\begin_layout Plain Layout

	echo"<li>Gestione menù</li>";
\end_layout

\begin_layout Plain Layout

	Ul_start();
\end_layout

\begin_layout Plain Layout

	  Pt("inspiatto.php", "Aggiunta piatti");
\end_layout

\begin_layout Plain Layout

	  Pt("modpiatto.php","Modifica menù");
\end_layout

\begin_layout Plain Layout

	  Pt("elimpiatto.php","Eliminazione piatti");
\end_layout

\begin_layout Plain Layout

	Ul_end();
\end_layout

\begin_layout Plain Layout

	echo"<li>Gestione Clienti</li>";
\end_layout

\begin_layout Plain Layout

	Ul_start();
\end_layout

\begin_layout Plain Layout

	  Pt("elimclienti.php", "Eliminazione clienti");
\end_layout

\begin_layout Plain Layout

	  Pt("vislog.php", "Visualizza log");
\end_layout

\begin_layout Plain Layout

	  Pt("vispunti.php", "Visualizza Punti clienti");
\end_layout

\begin_layout Plain Layout

	Ul_end();
\end_layout

\begin_layout Plain Layout

	echo"<li>Gestione Personale</li>";
\end_layout

\begin_layout Plain Layout

	Ul_start();
\end_layout

\begin_layout Plain Layout

	  Pt("vis_pers.php", "Visualizza personale");
\end_layout

\begin_layout Plain Layout

	  Pt("aggpers.php", "Aggiungi personale");
\end_layout

\begin_layout Plain Layout

	  Pt("elimpers.php", "Rimuovi personale");
\end_layout

\begin_layout Plain Layout

	Ul_end();
\end_layout

\begin_layout Plain Layout

      echo"<BR>";
\end_layout

\begin_layout Plain Layout

      Pt("ricevute.php", "Emissione ricevute");
\end_layout

\begin_layout Plain Layout

      Pt("vis_ricevute.php", "Visione ricevute");
\end_layout

\begin_layout Plain Layout

      echo"<BR>";
\end_layout

\begin_layout Plain Layout

      Pt("pren_libera.php", "Prenotazione libera");
\end_layout

\begin_layout Plain Layout

      Ul_end();
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  echo"<BR>";
\end_layout

\begin_layout Plain Layout

  echo"<li>Gestione Profilo</li>";
\end_layout

\begin_layout Plain Layout

    Ul_start();
\end_layout

\begin_layout Plain Layout

      Pt("vis_pren.php", "Visualizza le tue prenotazioni");
\end_layout

\begin_layout Plain Layout

      Pt("crea_pren.php", "Crea una nuova prenotazione");
\end_layout

\begin_layout Plain Layout

      Pt("saldo.php","Visione Punti");
\end_layout

\begin_layout Plain Layout

      Pt("aggiornadati.php","Cambio dati personali");
\end_layout

\begin_layout Plain Layout

      Pt("cambiapassword.php","Cambio Password");
\end_layout

\begin_layout Plain Layout

    Ul_end();
\end_layout

\begin_layout Plain Layout

  echo"<BR>";
\end_layout

\begin_layout Plain Layout

  vis_menu();
\end_layout

\begin_layout Plain Layout

  Pt("orari.php","Guarda gli orari");
\end_layout

\begin_layout Plain Layout

  Ul_end();
\end_layout

\begin_layout Plain Layout

echo<<<END
\end_layout

\begin_layout Plain Layout

  </div>
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  <div id="content" style="position: absolute;left: 50%; padding: 20px;">
\end_layout

\begin_layout Plain Layout

    <img width="368" height="569" alt="Esempio di piatto" src="img2.jpg"
 />
\end_layout

\begin_layout Plain Layout

  </div>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
logout.php
\end_layout

\begin_layout Standard
Lo script logout.php distrugge le variabili di sessione e riporta alla home.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

	require("libreria.php");
\end_layout

\begin_layout Plain Layout

	$login=authenticate();
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	/* distrugge la sessione */
\end_layout

\begin_layout Plain Layout

	$sname=session_name();
\end_layout

\begin_layout Plain Layout

	session_destroy();
\end_layout

\begin_layout Plain Layout

	if (isset($_COOKIE['logged'])) {
\end_layout

\begin_layout Plain Layout

	  setcookie($sname,'', time()-3600,'/');
\end_layout

\begin_layout Plain Layout

	};
\end_layout

\begin_layout Plain Layout

	header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
vis_pren.php
\end_layout

\begin_layout Standard
La pagina permette al generico utente di avere una panoramica sulle prenotazioni
 a suo nome: gli vengono mostrate tre tabelle, la prima con le prenotazioni
 ancora attive, seguita da una con le prenotazioni scadute, infine sono
 visibili anche le ricevute sugli acquisti che ha fatto.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

$login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

{
\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  subtitle("Visualizza le tue Prenotazioni");
\end_layout

\begin_layout Plain Layout

  $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

  //leggi i dati del cliente
\end_layout

\begin_layout Plain Layout

  //cerca tutte le sue prenotazioni e stampale
\end_layout

\begin_layout Plain Layout

  $aid=mysql_query("select Id from Utenti where Login='$login'",$conn);
\end_layout

\begin_layout Plain Layout

  $did=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

  $idcliente=$did[0];
\end_layout

\begin_layout Plain Layout

  $aid=mysql_query("select curdate()",$conn);
\end_layout

\begin_layout Plain Layout

  $dta=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

  $date=$dta[0];
\end_layout

\begin_layout Plain Layout

  subtitle("Prenotazioni attive");
\end_layout

\begin_layout Plain Layout

  $query_pren="select Codice, DataPren, DataCrea, NumeroPosti from Prenotazioni
 where CodCliente='$idcliente' and DataPren>='$date' and Codice Not in (select
 Codice from Ricevute) order by DataPren desc";
\end_layout

\begin_layout Plain Layout

  $ris=mysql_query($query_pren,$conn);
\end_layout

\begin_layout Plain Layout

  if(mysql_num_rows($ris) ==0)
\end_layout

\begin_layout Plain Layout

    echo"Non ci sono prenotazioni pendenti";
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $h=array("Codice prenotazione", "Data prenotazione", "Data creazione",
 "Numero posti");
\end_layout

\begin_layout Plain Layout

    table_start($h);
\end_layout

\begin_layout Plain Layout

    while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

      echo_row($row);
\end_layout

\begin_layout Plain Layout

    table_end();  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  subtitle("Prenotazioni scadute");
\end_layout

\begin_layout Plain Layout

  $query_pren="select Codice, DataPren, DataCrea, NumeroPosti from Prenotazioni
 where CodCliente='$idcliente' and DataPren<'$date' order by DataPren desc";
\end_layout

\begin_layout Plain Layout

  $ris=mysql_query($query_pren,$conn);
\end_layout

\begin_layout Plain Layout

  if(mysql_num_rows($ris)==0)
\end_layout

\begin_layout Plain Layout

    echo"Non ci sono prenotazioni scadute";
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $h=array("Codice prenotazione", "Data prenotazione", "Data creazione",
 "Numero posti");
\end_layout

\begin_layout Plain Layout

    table_start($h);
\end_layout

\begin_layout Plain Layout

    while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

      echo_row($row);
\end_layout

\begin_layout Plain Layout

    table_end();  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

  subtitle("Ricevute emesse");
\end_layout

\begin_layout Plain Layout

  $query_pren="select Codice, DataPren, DataCrea, NumeroPosti, PrezzoPrenotazion
e(Codice), Totale, TotPunti from Prenotazioni natural join Ricevute where
 CodCliente='$idcliente' order by DataPren desc";
\end_layout

\begin_layout Plain Layout

  $ris=mysql_query($query_pren,$conn);
\end_layout

\begin_layout Plain Layout

  if(mysql_num_rows($ris)==0)
\end_layout

\begin_layout Plain Layout

    echo"Non sono stati fatti acquisti";
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $h=array("Codice prenotazione", "Data prenotazione", "Data creazione",
 "Numero posti","Totale","TotalePagato","Punti Spesi");
\end_layout

\begin_layout Plain Layout

    table_start($h);
\end_layout

\begin_layout Plain Layout

    while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

      echo_row($row);
\end_layout

\begin_layout Plain Layout

    table_end();  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

  back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
crea_pren.php
\end_layout

\begin_layout Standard
Attraverso questa pagina l'utente generico ha la possibilità di creare una
 nuova prenotazione.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

$login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

{
\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  subtitle("Inserisci una nuova prenotazione");
\end_layout

\begin_layout Plain Layout

  $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

    $n=0;  
\end_layout

\begin_layout Plain Layout

    $pl=$_POST['nporz'];
\end_layout

\begin_layout Plain Layout

    foreach($pl as $d)
\end_layout

\begin_layout Plain Layout

      $n+=$d;
\end_layout

\begin_layout Plain Layout

    if($n!=0){
\end_layout

\begin_layout Plain Layout

      //leggi i dati del cliente
\end_layout

\begin_layout Plain Layout

      //crea la prenotazione in Prenotazioni
\end_layout

\begin_layout Plain Layout

      //poi inserisci ogni piatto in PrenotazioniPiatti
\end_layout

\begin_layout Plain Layout

      $dataP=$_POST['sday'];
\end_layout

\begin_layout Plain Layout

      $np=$_POST['npers'];
\end_layout

\begin_layout Plain Layout

      $aid=mysql_query("select Id from Utenti where Login='$login'",$conn);
\end_layout

\begin_layout Plain Layout

      $did=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

      $idcliente=$did[0];
\end_layout

\begin_layout Plain Layout

      $idpr=creapren($idcliente,$dataP,$np) or $err="impossibile inserire
 la prenotazione corrente";
\end_layout

\begin_layout Plain Layout

      if(!isset($err)){
\end_layout

\begin_layout Plain Layout

	$cods=$_POST['ids'];
\end_layout

\begin_layout Plain Layout

	$i=0;
\end_layout

\begin_layout Plain Layout

	foreach($pl as $num){
\end_layout

\begin_layout Plain Layout

	  if($num>0){
\end_layout

\begin_layout Plain Layout

	    $codpiatto=$cods[$i];
\end_layout

\begin_layout Plain Layout

	    $query="insert into PrenotazioniPiatti values($idpr,$codpiatto,$num)";
\end_layout

\begin_layout Plain Layout

	    mysql_query($query,$conn) or $err="errore d'un piatto all'interno della
 prenotazione";
\end_layout

\begin_layout Plain Layout

	    if(isset($err)) echo"$err";
\end_layout

\begin_layout Plain Layout

	  }
\end_layout

\begin_layout Plain Layout

	  $i++;
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

	//mysql_query($query_el,$conn) or $err="impossibile inserire la prenotazione
 corrente; reinserire i dati";
\end_layout

\begin_layout Plain Layout

	echo"La prenotazione e` stata inserita con successo<BR>";
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else subtitle("nessun piatto selezionato");
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  echo"<form method='POST' action='crea_pren.php' border='0'>";
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  $h=array("Antipasti","Primi","Secondi","Contorni","Dolci","PiattiSpeciali","Be
vande");
\end_layout

\begin_layout Plain Layout

  $s=array("Antipasti","Primi","Secondi","Contorni","Dolci","Piatti Speciali","B
evande");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  echo"Inserisci il numero di persone:<input type='number' name='npers'
 min=1 size='3' value='1'>";
\end_layout

\begin_layout Plain Layout

  $ardate=mysql_fetch_array(mysql_query("select curdate()",$conn));
\end_layout

\begin_layout Plain Layout

  $date=$ardate[0];
\end_layout

\begin_layout Plain Layout

  echo"     Inserisci la data (nel formato MM/GG/AAAA): <input type='date'
 name='sday' min='$date' value='$date'><BR>";
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  table_start_NH(); 
\end_layout

\begin_layout Plain Layout

  for ($i=0; $i<=6; $i++) {
\end_layout

\begin_layout Plain Layout

    $name=$s[$i];
\end_layout

\begin_layout Plain Layout

    $table=$h[$i];
\end_layout

\begin_layout Plain Layout

    echo "<tr><th colspan='3'>$name </th></tr>";
\end_layout

\begin_layout Plain Layout

    $q="select p.CodPiatto, p.Nome, p.Costo from Piatti p Join $table t where
 p.CodPiatto=t.Codice";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($q,$conn);
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<tr><td>Non ci sono $name</td></tr>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_array($ris)){
\end_layout

\begin_layout Plain Layout

	echo"<tr><td>".$row["Nome"]."</td><td>".number_format($row["Costo"],2)."€</td>";
\end_layout

\begin_layout Plain Layout

	echo"<input type='hidden' name='ids[]' value='$row[CodPiatto]'>";
\end_layout

\begin_layout Plain Layout

	echo"<td><input type='number' name='nporz[]' min=0 size='3' value='0'></td>";
\end_layout

\begin_layout Plain Layout

	echo"</td></tr>";
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  table_end();
\end_layout

\begin_layout Plain Layout

  if(!isset($_POST['submit']) || !isset($_POST['Cod'])){
\end_layout

\begin_layout Plain Layout

    echo"<input type='submit' name='submit' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

    echo"<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  echo"</form>";
\end_layout

\begin_layout Plain Layout

  back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
saldo.php
\end_layout

\begin_layout Standard
Mediante questa pagina, l'utente generico riesce a vedere quanti punti ha
 accumultato fino a questo momento.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

$login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

{
\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    $query="select cf.TotPunti from CartaFedelta cf, Utenti u where u.Login='$logi
n' and u.Id=cf.IdCliente";
\end_layout

\begin_layout Plain Layout

    $r=mysql_query($query, $conn);
\end_layout

\begin_layout Plain Layout

    $p=mysql_fetch_array($r);
\end_layout

\begin_layout Plain Layout

    $tot=$p[0];
\end_layout

\begin_layout Plain Layout

    echo"Il tuo saldo punti ammonta a: <b><u> $tot punti</u></b><BR>Un punto
 permette uno sconto di __€<BR>";
\end_layout

\begin_layout Plain Layout

    echo"<BD>";
\end_layout

\begin_layout Plain Layout

    echo"<img align='center' alt='Immagine per la pagina del saldo punti'
 src='punti.jpg' />";
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

else
\end_layout

\begin_layout Plain Layout

  header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
aggiornadati.php
\end_layout

\begin_layout Standard
Questa pagina è molto simile a quella che permetteva all'utente di registrarsi,
 con la differenza che vengono inseriti come valori all'interno dei form,
 le crendenziali dell'utente che sono state memorizzate nel sistema.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged'])){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    //prendi tutti i vecchi dati, mettili nelle celle della form, fai i
 controlli e invia.
\end_layout

\begin_layout Plain Layout

    $query= "select * from Clienti natural join Utenti u where u.Login='$login'";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query, $conn);
\end_layout

\begin_layout Plain Layout

    $old=mysql_fetch_assoc($ris);
\end_layout

\begin_layout Plain Layout

    $nome = $old['Nome'];
\end_layout

\begin_layout Plain Layout

    $cognome= $old['Cognome'];
\end_layout

\begin_layout Plain Layout

    $email = $old['Email'];
\end_layout

\begin_layout Plain Layout

    $telefono = $old['Telefono'];
\end_layout

\begin_layout Plain Layout

    $Id=$old['Id'];
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      $nome = $_POST['nome'];
\end_layout

\begin_layout Plain Layout

      $cognome= $_POST['cognome'];
\end_layout

\begin_layout Plain Layout

      $email = $_POST['email'];
\end_layout

\begin_layout Plain Layout

      $telefono = $_POST['telefono'];
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

      if(!ctype_alpha($nome) || !ctype_alpha($cognome))
\end_layout

\begin_layout Plain Layout

	$err="Nome e cognome devono essere alfanumerici e non vuoti";
\end_layout

\begin_layout Plain Layout

	else if (isset($email) && ((strlen($telefono)>0) && !chkEmail($email)))
\end_layout

\begin_layout Plain Layout

	  $err="E- mail non valida";
\end_layout

\begin_layout Plain Layout

	  else if (isset($telefono) && ((strlen($telefono)>0) && !is_numeric($telefono)
))
\end_layout

\begin_layout Plain Layout

	    $err="il telefono deve essere numerico";
\end_layout

\begin_layout Plain Layout

	    else{
\end_layout

\begin_layout Plain Layout

	      //Inserisce il nuovo utente nella base di dati
\end_layout

\begin_layout Plain Layout

	      $nome = mysql_real_escape_string($nome);
\end_layout

\begin_layout Plain Layout

	      $cognome = mysql_real_escape_string($cognome);
\end_layout

\begin_layout Plain Layout

	      $email = mysql_real_escape_string($email);
\end_layout

\begin_layout Plain Layout

	      $telefono = mysql_real_escape_string($telefono);
\end_layout

\begin_layout Plain Layout

	      $query="update Clienti set Nome='$nome', Cognome='$cognome', Email='$emai
l', Telefono='$telefono' where Id='$Id';";
\end_layout

\begin_layout Plain Layout

	      mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

	      echo"<b>Query riuscita correttamente</b><BR>";
\end_layout

\begin_layout Plain Layout

	      $_SESSION['nome']=$nome;
\end_layout

\begin_layout Plain Layout

	    };
\end_layout

\begin_layout Plain Layout

    };  
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  form_start("POST","aggiornadati.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\begin_layout Plain Layout

  <b>Nome</b>	  
\end_layout

\begin_layout Plain Layout

    <input type='text' name='nome' value='<?php echo $nome;?>'><br><br>
\end_layout

\begin_layout Plain Layout

    <b>Cognome</b>
\end_layout

\begin_layout Plain Layout

    <input type='text' name='cognome' value='<?php echo $cognome;?>'><br><br>
\end_layout

\begin_layout Plain Layout

    <b>Telefono</b>
\end_layout

\begin_layout Plain Layout

    <input type='text' name='telefono' value='<?php echo $telefono;?>'>
 - campo non obbligatorio - <br><br>
\end_layout

\begin_layout Plain Layout

    <b>Mail</b>
\end_layout

\begin_layout Plain Layout

    <input type='text' name='email' value='<?php echo $email;?>'> - campo
 non obbligatorio - <br><br>
\end_layout

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  form_end();
\end_layout

\begin_layout Plain Layout

  if(isset($err))
\end_layout

\begin_layout Plain Layout

    echo"<BR><b>Errore: $err</b>";
\end_layout

\begin_layout Plain Layout

  back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
cambiapassword.php
\end_layout

\begin_layout Standard
Questa pagina crea un form che permette all'utente di cambiare la password,
 purché venga inserita la vecchia password corretta, che la nuova password
 venga inserita correttamente 2 volte e che abbia una lunghezza di almeno
 8 caratteri.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged'])){
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      $old=SHA1($_POST['oldpwd']);
\end_layout

\begin_layout Plain Layout

      $pwd=SHA1($_POST['pwd']);
\end_layout

\begin_layout Plain Layout

      $conferma=SHA1($_POST['conf']);
\end_layout

\begin_layout Plain Layout

      $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

      $query= "select * from Utenti where Login='$login' and password='$old'";
\end_layout

\begin_layout Plain Layout

      $ris=mysql_query($query, $conn);
\end_layout

\begin_layout Plain Layout

      if(mysql_num_rows($ris)!=1)
\end_layout

\begin_layout Plain Layout

	$err="La vecchia password è sbagliata";
\end_layout

\begin_layout Plain Layout

      elseif($pwd!=$conferma) $err="La nuova password e la conferma devono
 essere uguali";
\end_layout

\begin_layout Plain Layout

	else{
\end_layout

\begin_layout Plain Layout

	  $query="Update Utenti set password='$pwd' where Login='$login'";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

	  echo"<p><b>Password cambiata correttamente</b></p>";
\end_layout

\begin_layout Plain Layout

	  }
\end_layout

\begin_layout Plain Layout

      };
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    form_start('POST','cambiapassword.php');
\end_layout

\begin_layout Plain Layout

  echo<<<END
\end_layout

\begin_layout Plain Layout

	Vecchia Password: <input type="password" name="oldpwd"> <BR>
\end_layout

\begin_layout Plain Layout

	Nuova Password: <input type="password" name="pwd"> <BR>
\end_layout

\begin_layout Plain Layout

	Conferma Password: <input type="password" name="conf"> <BR>
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

    form_end();
\end_layout

\begin_layout Plain Layout

      if(isset($err))
\end_layout

\begin_layout Plain Layout

	echo"<BR><b>Errore: $err</b>";   
\end_layout

\begin_layout Plain Layout

      back("operazioni.php"); 
\end_layout

\begin_layout Plain Layout

      page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

else
\end_layout

\begin_layout Plain Layout

  header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
pren_serata.php
\end_layout

\begin_layout Standard
Questa è la prima delle pagine cui può aggedere solo chi è gestore.
 Vengono presentate le prenotazioni per la sera corrente, mostrando 3 tabelle,
 una che ha la panoramica delle persone che han prenotato ed i posti richiesti
 per ognuna; un'altra che mostra, prenotazione per prenotazione, le pietanze
 da preparare; l'ultima tabella è destinata più ad un cuoco, perché mette
 assieme tutti i piatti da cucinare quella sera e mostra le porzioni che
 dovranno esssere preparate, piatto per piatto.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

$login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']) && ($_SESSION['livello']==2))
\end_layout

\begin_layout Plain Layout

{
\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

  $aid=mysql_query("select curdate()",$conn);
\end_layout

\begin_layout Plain Layout

  $dta=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

  $date=$dta[0];
\end_layout

\begin_layout Plain Layout

  subtitle("Prenotazioni per la sera del $date");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  $query="select p.Codice, u.Login, c.Nome, c.Cognome, u.Id, p.DataPren, p.DataCrea,
 p.NumeroPosti from Prenotazioni p join Clienti c on p.CodCliente=c.Id natural
 join Utenti u where p.DataPren='$date' and Codice Not in (select Codice
 from Ricevute) order by NumeroPosti";
\end_layout

\begin_layout Plain Layout

  $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

  if(mysql_num_rows($ris) ==0)
\end_layout

\begin_layout Plain Layout

    echo"Non ci sono prenotazioni per la sera corrente";
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $h=array("Codice prenotazione", "Username Cl.", "Nome Cl.","Cognome Cl.","Codic
e Cl.", "Data prenotazione", "data creazione", "numero posti");
\end_layout

\begin_layout Plain Layout

    table_start($h);
\end_layout

\begin_layout Plain Layout

    while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

      echo_row($row);
\end_layout

\begin_layout Plain Layout

    table_end();  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  echo"<BR>";
\end_layout

\begin_layout Plain Layout

  subtitle("Piatti da preparare per la serata corrente");
\end_layout

\begin_layout Plain Layout

  $query="select pp.CodPrenotazione, pp.NPorzioni, Nome from Prenotazioni
 p join PrenotazioniPiatti pp on p.Codice=pp.CodPrenotazione natural join
 Piatti where p.DataPren='$date' and Codice Not in (select Codice from Ricevute)
 order by CodPrenotazione";
\end_layout

\begin_layout Plain Layout

  $ris2=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

  if(mysql_num_rows($ris2) ==0)
\end_layout

\begin_layout Plain Layout

    echo"Non ci sono prenotazioni per la sera corrente";
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $h=array("Codice prenotazione", "N.
 Porzioni", "Nome piatto");
\end_layout

\begin_layout Plain Layout

    table_start($h);
\end_layout

\begin_layout Plain Layout

    while($row=mysql_fetch_assoc($ris2))
\end_layout

\begin_layout Plain Layout

      echo_row($row);
\end_layout

\begin_layout Plain Layout

    table_end();  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  echo"<BR>";
\end_layout

\begin_layout Plain Layout

  subtitle("Porzioni da preparare per la serata corrente");
\end_layout

\begin_layout Plain Layout

  $query="select sum(NPorzioni), Nome from Prenotazioni p join PrenotazioniPiatt
i pp on p.Codice=pp.CodPrenotazione natural join Piatti where p.DataPren='$date'
 and Codice Not in (select Codice from Ricevute) group by CodPiatto order
 by CodPrenotazione;";
\end_layout

\begin_layout Plain Layout

  $ris3=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

  if(mysql_num_rows($ris3) ==0)
\end_layout

\begin_layout Plain Layout

    echo"Non ci sono prenotazioni per la sera corrente";
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    $h=array("N.
 Porzioni", "Nome piatto");
\end_layout

\begin_layout Plain Layout

    table_start($h);
\end_layout

\begin_layout Plain Layout

    while($row=mysql_fetch_assoc($ris3))
\end_layout

\begin_layout Plain Layout

      echo_row($row);
\end_layout

\begin_layout Plain Layout

    table_end();  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
pren_scelta.php
\end_layout

\begin_layout Standard
Questa pagina è molto simile alla precedente, la differenza sta nel fatto
 che permette di selezionare una sera specifica, od un intervallo di serate
 mediante una coppia di form.
 Il risultato viene fornito sulla base della form utilizzata.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

$login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']) && ($_SESSION['livello']==2))
\end_layout

\begin_layout Plain Layout

{
\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

  $aid=mysql_query("select curdate()",$conn);
\end_layout

\begin_layout Plain Layout

  $dta=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

  $date=$dta[0];
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      $date=$_POST['sday'];
\end_layout

\begin_layout Plain Layout

      $query="select p.Codice, u.Login, c.Nome, c.Cognome, u.Id, p.DataPren, p.DataCrea
, p.NumeroPosti from Prenotazioni p join Clienti c on p.CodCliente=c.Id natural
 join Utenti u where p.DataPren='$date' and Codice Not in (select Codice
 from Ricevute) order by NumeroPosti";
\end_layout

\begin_layout Plain Layout

      $query2="select pp.CodPrenotazione, pp.NPorzioni, Nome from Prenotazioni
 p join PrenotazioniPiatti pp on p.Codice=pp.CodPrenotazione natural join
 Piatti where p.DataPren='$date' and Codice Not in (select Codice from Ricevute)
 order by CodPrenotazione";
\end_layout

\begin_layout Plain Layout

      $query3="select sum(NPorzioni), Nome from Prenotazioni p join Prenotazioni
Piatti pp on p.Codice=pp.CodPrenotazione natural join Piatti where p.DataPren='$dat
e' and Codice Not in (select Codice from Ricevute) group by CodPiatto order
 by CodPrenotazione;";
\end_layout

\begin_layout Plain Layout

      $s1="la sera del $date";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  elseif(isset($_POST['submit1'])){
\end_layout

\begin_layout Plain Layout

      $date1=$_POST['sday1'];
\end_layout

\begin_layout Plain Layout

      $date2=$_POST['sday2'];
\end_layout

\begin_layout Plain Layout

      $query="select p.Codice, u.Login, c.Nome, c.Cognome, u.Id, p.DataPren, p.DataCrea
, p.NumeroPosti from Prenotazioni p join Clienti c on p.CodCliente=c.Id natural
 join Utenti u where p.DataPren>='$date1' and p.DataPren<='$date2' and Codice
 Not in (select Codice from Ricevute) order by NumeroPosti";
\end_layout

\begin_layout Plain Layout

      $query2="select pp.CodPrenotazione, pp.NPorzioni, Nome from Prenotazioni
 p join PrenotazioniPiatti pp on p.Codice=pp.CodPrenotazione natural join
 Piatti where p.DataPren>='$date1' and p.DataPren<='$date2' and Codice Not
 in (select Codice from Ricevute) order by CodPrenotazione";
\end_layout

\begin_layout Plain Layout

      $query3="select sum(NPorzioni), Nome from Prenotazioni p join Prenotazioni
Piatti pp on p.Codice=pp.CodPrenotazione natural join Piatti where p.DataPren>='$da
te1' and p.DataPren<='$date2' and Codice Not in (select Codice from Ricevute)
 group by CodPiatto order by CodPrenotazione;";
\end_layout

\begin_layout Plain Layout

      $s1="le sere tra il $date1 ed il $date2";
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    elseif(!isset($_POST['submit']) || !isset($_POST['submit1']) ){
\end_layout

\begin_layout Plain Layout

      form_start("POST","pren_scelta.php");
\end_layout

\begin_layout Plain Layout

      echo "Seleziona un giorno specifico od un intervallo di cui vuoi conoscere
 le prenotazioni<BR>";
\end_layout

\begin_layout Plain Layout

      echo "<p>Inserisci la data (nel formato MM/GG/AAAA): <input type='date'
 name='sday'  value='$date'>   ";
\end_layout

\begin_layout Plain Layout

      echo "<input type='submit' name='submit' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

      echo "<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

      echo"<BR>";
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

      echo "<p>Inserisci la data (nel formato MM/GG/AAAA): <input type='date'
 name='sday1'  value='$date'> - <input type='date' name='sday2' value='$date'>
   ";
\end_layout

\begin_layout Plain Layout

      echo "<input type='submit' name='submit1' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

      echo "<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  if(isset($_POST['submit']) || isset($_POST['submit1']) ){
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    echo"<p><a href='pren_scelta.php'><b><i>Nuova ricerca</i></b></a></p>";
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    subtitle("Prenotazioni per $s1");
\end_layout

\begin_layout Plain Layout

    //leggi i dati del cliente
\end_layout

\begin_layout Plain Layout

    //cerca tutte le sue prenotazioni e stampale
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    if(mysql_num_rows($ris) ==0)
\end_layout

\begin_layout Plain Layout

	  echo"Non ci sono prenotazioni per $s1";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      $h=array("Codice prenotazione", "Username Cl.", "Nome Cl.","Cognome
 Cl.","Codice Cl.", "Data prenotazione", "data creazione", "numero posti");
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();  
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

    echo"<BR>";
\end_layout

\begin_layout Plain Layout

    subtitle("Piatti da preparare per $s1");
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    $ris2=mysql_query($query2,$conn);
\end_layout

\begin_layout Plain Layout

    if(mysql_num_rows($ris2) ==0)
\end_layout

\begin_layout Plain Layout

	  echo"Non ci sono prenotazioni per $s1";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      $h=array("Codice prenotazione", "N.
 Porzioni", "Nome piatto");
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($ris2))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();  
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    echo"<BR>";
\end_layout

\begin_layout Plain Layout

    subtitle("Porzioni da preparare per $s1");
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    $ris3=mysql_query($query3,$conn);
\end_layout

\begin_layout Plain Layout

    if(mysql_num_rows($ris3) ==0)
\end_layout

\begin_layout Plain Layout

	  echo"Non ci sono prenotazioni per $s1";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      $h=array("N.
 Porzioni", "Nome piatto");
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($ris3))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();  
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
inspiatto.php
\end_layout

\begin_layout Standard
Questa pagina fornisce una form attraverso cui inserire un nuovo piatto
 all'interno del menù.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Inserimento d'un nuovo piatto nel menu`");
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      $nome=$_POST['nome'];
\end_layout

\begin_layout Plain Layout

      $costo=$_POST['costo_i'] + $_POST['costo_d']/100;
\end_layout

\begin_layout Plain Layout

      $port=$_POST['portata'];
\end_layout

\begin_layout Plain Layout

      if(!isset($nome))
\end_layout

\begin_layout Plain Layout

	$err="Il nome non e` stato inserito o non e` composto di sole lettere";
\end_layout

\begin_layout Plain Layout

      elseif(!isset($_POST['portata']))
\end_layout

\begin_layout Plain Layout

	$err="Non e` stata selezionata la portata";
\end_layout

\begin_layout Plain Layout

	else{
\end_layout

\begin_layout Plain Layout

	  $query1="select max(CodPiatto) from Piatti";
\end_layout

\begin_layout Plain Layout

	  $ris=mysql_query($query1,$conn);
\end_layout

\begin_layout Plain Layout

	  if(!isset($ris))
\end_layout

\begin_layout Plain Layout

	    $n=1;
\end_layout

\begin_layout Plain Layout

	  else{
\end_layout

\begin_layout Plain Layout

	    $temp=mysql_fetch_array($ris);
\end_layout

\begin_layout Plain Layout

	    $n=1+$temp[0];
\end_layout

\begin_layout Plain Layout

	  };
\end_layout

\begin_layout Plain Layout

	  $query2="insert into Piatti values($n,'$nome',$costo)";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query2,$conn) or ($err="errore nell'inserimento tra i piatti");
\end_layout

\begin_layout Plain Layout

	  $h=array("Antipasti","Primi","Secondi","Contorni","Dolci","PiattiSpeciali","B
evande");
\end_layout

\begin_layout Plain Layout

	  $j=$h[$port];
\end_layout

\begin_layout Plain Layout

	  $query3="insert into $j values($n)";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query3,$conn) or ($err="errore nell'inserimento tra le portate")
;
\end_layout

\begin_layout Plain Layout

	};
\end_layout

\begin_layout Plain Layout

      if(!isset($err))
\end_layout

\begin_layout Plain Layout

	echo"<b>Il piatto $nome e` stato inserito con successo in: $j<BR></b";
\end_layout

\begin_layout Plain Layout

      else{ echo"<b>Non e` stato possibile inserire il piatto con successo
 perche`:</b><BR>";
\end_layout

\begin_layout Plain Layout

	echo"$err";
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    form_start("POST","inspiatto.php");
\end_layout

\begin_layout Plain Layout

      ?>
\end_layout

\begin_layout Plain Layout

	Nome: <input type="text" name="nome" size="50">
\end_layout

\begin_layout Plain Layout

	<BR>
\end_layout

\begin_layout Plain Layout

	Costo: <input type="number" name="costo_i" min=0 size='3'>,<input type="number"
 name="costo_d" min=0 max=99 size='2'><BR>
\end_layout

\begin_layout Plain Layout

	Tipo:<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="0"> Antipasto<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="1"> Primo<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="2"> Secondo<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="3"> Contorno<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="4"> Dolce<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="5"> Piatto Speciale<BR>
\end_layout

\begin_layout Plain Layout

	  <input type="radio" name="portata" value="6"> Bibita<BR>
\end_layout

\begin_layout Plain Layout

	  
\end_layout

\begin_layout Plain Layout

      <BR>
\end_layout

\begin_layout Plain Layout

      <?php
\end_layout

\begin_layout Plain Layout

      form_end();
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

	else
\end_layout

\begin_layout Plain Layout

	  header("home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
modpiatto.php
\end_layout

\begin_layout Standard
Questa pagina permette un piatto presente nel menù e di modificarlo.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Modifica di un piatto del menu`");
\end_layout

\begin_layout Plain Layout

    echo"<form method='POST' action='modpiatto.php' border='0'>";
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit1'])){
\end_layout

\begin_layout Plain Layout

	$id=$_POST['Cod1'];
\end_layout

\begin_layout Plain Layout

	$nome=$_POST['nome1'];
\end_layout

\begin_layout Plain Layout

	$costo=$_POST['costo_i'] + ($_POST['costo_d'])/100;
\end_layout

\begin_layout Plain Layout

	$costoi=(int)($costo);
\end_layout

\begin_layout Plain Layout

	$costod=(int)(($costo-$costoi)*100);
\end_layout

\begin_layout Plain Layout

	if(!isset($nome))
\end_layout

\begin_layout Plain Layout

	  $err="Il nome non e` stato inserito o non e` composto di sole lettere";
\end_layout

\begin_layout Plain Layout

	  else{
\end_layout

\begin_layout Plain Layout

	    $query2="Update Piatti p set p.Nome='$nome', p.Costo=$costo where p.CodPiatto=
$id;";
\end_layout

\begin_layout Plain Layout

	    mysql_query($query2,$conn) or ($err="errore nell'inserimento tra i
 piatti");
\end_layout

\begin_layout Plain Layout

	  };
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    elseif(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      if(isset($_POST['Cod'])){
\end_layout

\begin_layout Plain Layout

	//prendi i dati dalla $_POST, mettili nelle celle, ed esegui 
\end_layout

\begin_layout Plain Layout

	$id=$_POST['Cod'];
\end_layout

\begin_layout Plain Layout

	$query="select* from Piatti where CodPiatto=$id;";
\end_layout

\begin_layout Plain Layout

	$arr=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

	$ris=mysql_fetch_array($arr);
\end_layout

\begin_layout Plain Layout

	$nome=$ris[1];
\end_layout

\begin_layout Plain Layout

	$costoi=(int)($ris[2]);
\end_layout

\begin_layout Plain Layout

	$costod=(int)(($ris[2]-$costoi)*100);
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      else $err="non e` stato selezionato alcun piatto";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

      if(((isset($_POST['submit1'])) && isset($err)) || ((isset($_POST['submit']
)) && (isset($_POST['Cod'])))){
\end_layout

\begin_layout Plain Layout

	echo<<<END
\end_layout

\begin_layout Plain Layout

	  Nome: <input type="text" name="nome1" size="70" value='$nome' >
\end_layout

\begin_layout Plain Layout

	  <BR>
\end_layout

\begin_layout Plain Layout

	  Costo: <input type="number" name="costo_i" min=0 size='3' value='$costoi'>,<i
nput type="number" name="costo_d" min=0 max=99 size='2' value='$costod'><BR>
\end_layout

\begin_layout Plain Layout

	  <input type="hidden" name="Cod1" value='$id'>
\end_layout

\begin_layout Plain Layout

	  <input type="submit" name="submit1" value="Procedi">
\end_layout

\begin_layout Plain Layout

END;
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit1'])){
\end_layout

\begin_layout Plain Layout

      if(!isset($err))
\end_layout

\begin_layout Plain Layout

	echo"<BR><b>Il piatto $nome e` stato modificato con successo<BR></b>";
\end_layout

\begin_layout Plain Layout

      else{ echo"<BR><b>E` stato riscontrato un errore: </b>";
\end_layout

\begin_layout Plain Layout

	echo"$err<BR>";
\end_layout

\begin_layout Plain Layout

      };
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    elseif(isset($err))
\end_layout

\begin_layout Plain Layout

      echo"$err<BR>";
\end_layout

\begin_layout Plain Layout

    $h=array("Antipasti","Primi","Secondi","Contorni","Dolci","PiattiSpeciali","
Bevande");
\end_layout

\begin_layout Plain Layout

    $s=array("Antipasti","Primi","Secondi","Contorni","Dolci","Piatti Speciali",
"Bevande");
\end_layout

\begin_layout Plain Layout

    table_start_NH();
\end_layout

\begin_layout Plain Layout

    for ($i=0; $i<=6; $i++) {
\end_layout

\begin_layout Plain Layout

      $name=$s[$i];
\end_layout

\begin_layout Plain Layout

      $table=$h[$i];
\end_layout

\begin_layout Plain Layout

      echo "<tr><th colspan='3'>$name </th></tr>";
\end_layout

\begin_layout Plain Layout

      $q="select p.CodPiatto, p.Nome, p.Costo from Piatti p Join $table t where
 p.CodPiatto=t.Codice";
\end_layout

\begin_layout Plain Layout

      $ris=mysql_query($q,$conn);
\end_layout

\begin_layout Plain Layout

      $num_righe=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

      if(!$num_righe)
\end_layout

\begin_layout Plain Layout

	echo"<tr><td>Non ci sono $name</td></tr>";
\end_layout

\begin_layout Plain Layout

      else{
\end_layout

\begin_layout Plain Layout

	while($row=mysql_fetch_array($ris)){
\end_layout

\begin_layout Plain Layout

	  echo"<tr><td>".$row["Nome"]."</td><td>".number_format($row["Costo"],2)."€</td>";
\end_layout

\begin_layout Plain Layout

	  echo"<td><input type='radio' name='Cod' value=$row[0]></td>";
\end_layout

\begin_layout Plain Layout

	  echo"</td></tr>";
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    table_end();
\end_layout

\begin_layout Plain Layout

    if(!isset($_POST['submit']) || !isset($_POST['Cod'])){
\end_layout

\begin_layout Plain Layout

      echo"<input type='submit' name='submit' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

      echo"<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    echo"</form>";
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
elimpiatto.php
\end_layout

\begin_layout Standard
Questa pagina è molto simile alla precedente; differisce nel fatto che qui
 il piatto viene eliminato.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Eliminazione piatti dal menu`");
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      if(isset($_POST['Cod'])){
\end_layout

\begin_layout Plain Layout

	$cods=$_POST['Cod'];
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	foreach($cods as $d){
\end_layout

\begin_layout Plain Layout

	  $query_el="delete from Piatti where CodPiatto='$d'";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query_el,$conn) or err('impossibile eliminare Id=$d');
\end_layout

\begin_layout Plain Layout

	  echo"Il piatto con codice='$d' e` stato cancellato con successo<BR>";
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      else subtitle("nessun piatto selezionato");
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    $h=array("Antipasti","Primi","Secondi","Contorni","Dolci","PiattiSpeciali","
Bevande");
\end_layout

\begin_layout Plain Layout

    $s=array("Antipasti","Primi","Secondi","Contorni","Dolci","Piatti Speciali",
"Bevande");
\end_layout

\begin_layout Plain Layout

    form_start("POST","elimpiatto.php");
\end_layout

\begin_layout Plain Layout

    table_start_NH();
\end_layout

\begin_layout Plain Layout

    for ($i=0; $i<=6; $i++) {;
\end_layout

\begin_layout Plain Layout

      $name=$s[$i];
\end_layout

\begin_layout Plain Layout

      $table=$h[$i];
\end_layout

\begin_layout Plain Layout

      echo "<tr><th>$name </th></tr>";
\end_layout

\begin_layout Plain Layout

      $q="select p.CodPiatto, p.Nome, p.Costo from Piatti p Join $table t where
 p.CodPiatto=t.Codice";
\end_layout

\begin_layout Plain Layout

      $ris=mysql_query($q,$conn);
\end_layout

\begin_layout Plain Layout

      $num_righe=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

      if(!$num_righe)
\end_layout

\begin_layout Plain Layout

	echo"<tr><td>Non ci sono $name</td></tr>";
\end_layout

\begin_layout Plain Layout

      else{
\end_layout

\begin_layout Plain Layout

	while($row=mysql_fetch_array($ris)){
\end_layout

\begin_layout Plain Layout

	  echo"<tr><td>".$row["Nome"]."</td><td>".number_format($row["Costo"],2)."€</td>";
\end_layout

\begin_layout Plain Layout

	  echo"<td><input type='checkbox' name='Cod[]' value=$row[0]></td>";
\end_layout

\begin_layout Plain Layout

	  echo"</td></tr>";
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    table_end();
\end_layout

\begin_layout Plain Layout

    form_end();
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
elimclienti.php
\end_layout

\begin_layout Standard
Con questa pagina è possibile selezionare un qualcunque utente del sito,
 ad eccezione di quello che sta compiendo l'operazione.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Eliminazione clienti");
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      if(isset($_POST['Ids'])){
\end_layout

\begin_layout Plain Layout

	$ids=$_POST['Ids'];
\end_layout

\begin_layout Plain Layout

	foreach($ids as $d){
\end_layout

\begin_layout Plain Layout

	  $query_el="delete from Clienti where Id='$d'";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query_el,$conn) or err('impossibile eliminare Id=$d');
\end_layout

\begin_layout Plain Layout

	  echo"Il cliente con Id='$d' e` stato cancellato con successo<BR>";
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      else subtitle("nessuna persona selezionata");
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    $login=$_SESSION['logged'];
\end_layout

\begin_layout Plain Layout

    $query="select Id from Utenti where Login='$login'";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $id=$ar[0];
\end_layout

\begin_layout Plain Layout

    $query="select c.Id, Nome, c.Cognome, c.DataReg from Clienti c where c.Id!='$id'
;";
\end_layout

\begin_layout Plain Layout

    $result=mysql_query($query,$conn)
\end_layout

\begin_layout Plain Layout

      or die("Query fallita".mysql_error($conn));
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $head=array('Id', 'Nome', 'Cognome', 'Data Registrazione', 'Scelta');
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($result);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<p>Non ci sono entry nella tabella Persone</p>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      form_start("POST","elimclienti.php");
\end_layout

\begin_layout Plain Layout

      table_start($head);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($result))
\end_layout

\begin_layout Plain Layout

	echo_row_CK($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

      form_end();
\end_layout

\begin_layout Plain Layout

      };
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else header("Location: home.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
vislog.php
\end_layout

\begin_layout Standard
Questa pagina permette di controllare gli accessi al sito.
 Crea una tabella con le login degli utenti che sono entrati e le date d'accesso.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Visione degli accessi al sistema");
\end_layout

\begin_layout Plain Layout

    $query= "select c.Id,c.Nome, c.Cognome, a.DataAccesso from Accessi a join
 Clienti c on a.CodCliente=c.Id order by a.CodLog desc;";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $n=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

    if($n>0){
\end_layout

\begin_layout Plain Layout

      $h=array('Id','Nome','Cognome','DataAccesso');
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

      while($row= mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      echo"Non ci sono stati accessi al database";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
vispunti.php
\end_layout

\begin_layout Standard
Questa pagina mostra i vari utenti
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Visione punti clienti");
\end_layout

\begin_layout Plain Layout

    $query= "select c.Id,c.Nome, c.Cognome, cf.TotPunti from Clienti c join
 CartaFedelta cf on c.Id=IdCliente order by cf.TotPunti desc;";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $n=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

    if($n>0){
\end_layout

\begin_layout Plain Layout

      $h=array('Id','Nome','Cognome','Totale Punti');
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

      while($row= mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      echo"Non ci sono stati accessi al database";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  table_end();
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
vis_pers.php, aggpers.php, elimpers.php
\end_layout

\begin_layout Standard
Queste pagine permettono di fare diverse operazioni sui membri del personale,
 avendone l'autorizzazione.
 La prima permette di visualizzare tutti i gestori, la seconda permette
 di trasformare dei clienti in gestori, la terza trasforma un gestore in
 cliente semplice, modificando il livello cui può accedere.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    $login=$_SESSION['logged'];
\end_layout

\begin_layout Plain Layout

    $query="select Id from Utenti where Login='$login'";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $id=$ar[0];
\end_layout

\begin_layout Plain Layout

    $query="select c.Id, Nome, c.Cognome, c.DataReg from Clienti c Natural
 Join Utenti u where u.Livello=2";
\end_layout

\begin_layout Plain Layout

    $result=mysql_query($query,$conn)
\end_layout

\begin_layout Plain Layout

      or die("Query fallita".mysql_error($conn));
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $head=array('Id', 'Nome', 'Cognome', 'Data Registrazione');
\end_layout

\begin_layout Plain Layout

    subtitle("Visualizza membri del personale");
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($result);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<p>Non ci sono entry nella tabella del Personale</p>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      table_start($head);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($result))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

      };
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      if(isset($_POST['Ids'])){
\end_layout

\begin_layout Plain Layout

	$ids=$_POST['Ids'];
\end_layout

\begin_layout Plain Layout

	foreach($ids as $d){
\end_layout

\begin_layout Plain Layout

	  $query_el="update Utenti set Livello=2 where Id='$d'";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query_el,$conn) or err('impossibile aggiungere Id=$d');
\end_layout

\begin_layout Plain Layout

	  echo"Il cliente con Id='$d' e` stato aggiunto con successo al personale<BR>";
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      else subtitle("nessuna persona selezionata");  
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    $login=$_SESSION['logged'];
\end_layout

\begin_layout Plain Layout

    $query="select Id from Utenti where Login='$login'";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $id=$ar[0];
\end_layout

\begin_layout Plain Layout

    $query="select c.Id, Nome, c.Cognome, c.DataReg from Clienti c Natural
 Join Utenti u where u.Id!=1 and u.Livello!=2";
\end_layout

\begin_layout Plain Layout

    $result=mysql_query($query,$conn)
\end_layout

\begin_layout Plain Layout

      or die("Query fallita".mysql_error($conn));
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $head=array('Id', 'Nome', 'Cognome', 'Data Registrazione', 'Scelta');
\end_layout

\begin_layout Plain Layout

    subtitle("Aggiunta al personale");
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($result);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<p>Non ci sono altre entry nella tabella Persone che e` possibile
 aggiungere</p>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      form_start("POST","aggpers.php");
\end_layout

\begin_layout Plain Layout

      table_start($head);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($result))
\end_layout

\begin_layout Plain Layout

	echo_row_CK($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

      form_end();
\end_layout

\begin_layout Plain Layout

      };
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  ?>
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Cancellazione membri del personale");
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

      if(isset($_POST['Ids'])){
\end_layout

\begin_layout Plain Layout

	$ids=$_POST['Ids'];
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	foreach($ids as $d){
\end_layout

\begin_layout Plain Layout

	  $query_el="update Utenti set Livello=1 where Id='$d'";
\end_layout

\begin_layout Plain Layout

	  mysql_query($query_el,$conn) or err('impossibile eliminare Id=$d');
\end_layout

\begin_layout Plain Layout

	  echo"L'utente con Id='$d' e` stato rimosso con successo dal personale<BR>";
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

      else subtitle("nessuna persona selezionata");
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    $login=$_SESSION['logged'];
\end_layout

\begin_layout Plain Layout

    $query="select Id from Utenti where Login='$login'";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $id=$ar[0];
\end_layout

\begin_layout Plain Layout

    $query="select c.Id, Nome, c.Cognome, c.DataReg from Clienti c Natural
 Join Utenti u where u.Id!=1 and u.Livello=2";
\end_layout

\begin_layout Plain Layout

    $result=mysql_query($query,$conn)
\end_layout

\begin_layout Plain Layout

      or die("Query fallita".mysql_error($conn));
\end_layout

\begin_layout Plain Layout

    $ar=(mysql_fetch_array($ris));
\end_layout

\begin_layout Plain Layout

    $head=array('Id', 'Nome', 'Cognome', 'Data Registrazione', 'Scelta');
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($result);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<p>Non ci sono altri membri appartenenti al personale</p>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      form_start("POST","elimpers.php");
\end_layout

\begin_layout Plain Layout

      table_start($head);
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_assoc($result))
\end_layout

\begin_layout Plain Layout

	echo_row_CK($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

      form_end();
\end_layout

\begin_layout Plain Layout

      };
\end_layout

\begin_layout Plain Layout

      back("operazioni.php");
\end_layout

\begin_layout Plain Layout

      page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  ?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
ricevute.php
\end_layout

\begin_layout Standard
In questa pagina è possibile selezionare una delle prenotazioni relative
 alla sera corrente per cui non è ancora stata emessa una ricevuta, ed emettere
 la ricevuta relativa.
\end_layout

\begin_layout Standard
Questo avviene in due fasi: prima si seleziona tramite una form prima la
 prenotazione; fatto questo si seleziona poi un numero di punti che sia
 al massimo pari al minimo tra i punti del cliente e l'ammontare della ricevuta.
\end_layout

\begin_layout Standard
Ogni punto permette di scalare
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  include("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $title='Ma certo! Ristorante';
\end_layout

\begin_layout Plain Layout

    inizio_pagina($title);
\end_layout

\begin_layout Plain Layout

    subtitle("Emissione ricevute");
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    if(isset($_POST['submit1']))
\end_layout

\begin_layout Plain Layout

    {
\end_layout

\begin_layout Plain Layout

      $codPren=$_POST['CodPren'];
\end_layout

\begin_layout Plain Layout

      $npunti=$_POST['npunti'];
\end_layout

\begin_layout Plain Layout

      $query="call InserisciRicevuta($codPren,$npunti)";
\end_layout

\begin_layout Plain Layout

      $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

      $query2="select Codice, Totale, FLOOR(PrezzoPrenotazione($codPren)
 /10) from Ricevute where Codice=$codPren";
\end_layout

\begin_layout Plain Layout

      $ris2=mysql_query($query2,$conn);
\end_layout

\begin_layout Plain Layout

      $h=array("Codice Prenotazione", "Totale Pagato", "N.
 punti aggiunti");
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

	while($row=mysql_fetch_assoc($ris2))
\end_layout

\begin_layout Plain Layout

	  echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

      echo"<p><a href='ricevute.php'><b><i>Emetti una nuova ricevuta </i></b></a>
</p>";
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      if(isset($_POST['submit']))
\end_layout

\begin_layout Plain Layout

	{
\end_layout

\begin_layout Plain Layout

	$num=$_POST['B1'];
\end_layout

\begin_layout Plain Layout

	subtitle("Estremi prenotazione");
\end_layout

\begin_layout Plain Layout

	$query1="select p.Codice, p.DataCrea, p.DataPren, p.NumeroPosti, u.Login, PrezzoPren
otazione($num) from Prenotazioni p join Utenti u on p.CodCliente=u.Id where
 p.Codice=$num";
\end_layout

\begin_layout Plain Layout

	$ris1=mysql_query($query1,$conn);
\end_layout

\begin_layout Plain Layout

	$h=array("Codice pren", "Data pren", "Data creaz", "N.
 posti","Login Cl.","Tot (Euro)");
\end_layout

\begin_layout Plain Layout

	table_start($h);
\end_layout

\begin_layout Plain Layout

	while($row1=mysql_fetch_assoc($ris1))
\end_layout

\begin_layout Plain Layout

	  echo_row($row1);
\end_layout

\begin_layout Plain Layout

	table_end();
\end_layout

\begin_layout Plain Layout

	form_start("POST","ricevute.php");
\end_layout

\begin_layout Plain Layout

	$aid=mysql_fetch_array(mysql_query("select MaxPunti($num)",$conn));
\end_layout

\begin_layout Plain Layout

	$mpunti=$aid[0];
\end_layout

\begin_layout Plain Layout

	  echo"Inserisci i punti da togliere<input type='number' name='npunti'
 min=0 max=$mpunti size='3' value='0'> /$mpunti";
\end_layout

\begin_layout Plain Layout

	  echo"<input type='hidden' name='CodPren' value=$num>";
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	echo"<input type='submit' name='submit1' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

	echo"<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

	echo"</fieldset>";
\end_layout

\begin_layout Plain Layout

	echo"</form>";
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	echo"<BR>";
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	subtitle("Riepilogo prenotazione");
\end_layout

\begin_layout Plain Layout

	$query2="select pp.Nporzioni, pi.Nome, pi.Costo from Prenotazioni p join Prenotazi
oniPiatti pp on p.Codice=pp.COdPrenotazione natural join Piatti pi where p.Codice=$
num";
\end_layout

\begin_layout Plain Layout

	$ris2=mysql_query($query2,$conn);
\end_layout

\begin_layout Plain Layout

	$h=array("N.
 Porzioni","Nome Piatto","Costo(Euro)");
\end_layout

\begin_layout Plain Layout

	table_start($h);
\end_layout

\begin_layout Plain Layout

	  while($row=mysql_fetch_assoc($ris2))
\end_layout

\begin_layout Plain Layout

	    echo_row($row);
\end_layout

\begin_layout Plain Layout

	table_end();
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      
\end_layout

\begin_layout Plain Layout

      else
\end_layout

\begin_layout Plain Layout

	{
\end_layout

\begin_layout Plain Layout

	$aid=mysql_query("select curdate()",$conn);
\end_layout

\begin_layout Plain Layout

	$did=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

	$aid=mysql_query("select curdate()",$conn);
\end_layout

\begin_layout Plain Layout

	$dta=mysql_fetch_array($aid);
\end_layout

\begin_layout Plain Layout

	$date=$dta[0];
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	subtitle("Prenotazioni attive");
\end_layout

\begin_layout Plain Layout

	$query_pren="select Codice, DataPren, DataCrea, NumeroPosti, PrezzoPrenotazione
(Codice) from Prenotazioni where DataPren='$date' and Codice Not in (select
 Codice from Ricevute) order by DataPren desc";
\end_layout

\begin_layout Plain Layout

	$ris=mysql_query($query_pren,$conn);
\end_layout

\begin_layout Plain Layout

	if(mysql_num_rows($ris) ==0)
\end_layout

\begin_layout Plain Layout

	  echo"Non ci sono prenotazioni pendenti";
\end_layout

\begin_layout Plain Layout

	else{
\end_layout

\begin_layout Plain Layout

	  $h=array("Codice pren", "Data pren", "Data creaz", "N.
 posti","Tot (Euro)","Seleziona");
\end_layout

\begin_layout Plain Layout

	  form_start('POST','ricevute.php');
\end_layout

\begin_layout Plain Layout

	    table_start($h);
\end_layout

\begin_layout Plain Layout

	    while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

	      echo_row_RDB($row);
\end_layout

\begin_layout Plain Layout

	    table_end();
\end_layout

\begin_layout Plain Layout

	  form_end();
\end_layout

\begin_layout Plain Layout

	  }
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	subtitle("Prenotazioni scadute");
\end_layout

\begin_layout Plain Layout

	$query_pren="select Codice, DataPren, DataCrea, NumeroPosti, PrezzoPrenotazione
(Codice) from Prenotazioni where DataPren<'$date' order by DataPren desc";
\end_layout

\begin_layout Plain Layout

	$ris=mysql_query($query_pren,$conn);
\end_layout

\begin_layout Plain Layout

	if(mysql_num_rows($ris)==0)
\end_layout

\begin_layout Plain Layout

	  echo"Non ci sono prenotazioni scadute";
\end_layout

\begin_layout Plain Layout

	else{
\end_layout

\begin_layout Plain Layout

	  $h=array("Codice prenotazione", "Data prenotazione", "Data creazione",
 "Numero posti","Totale (Euro");
\end_layout

\begin_layout Plain Layout

	  table_start($h);
\end_layout

\begin_layout Plain Layout

	  while($row=mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

	    echo_row($row);
\end_layout

\begin_layout Plain Layout

	  table_end();  
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

    page_end();
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
vis_ricevute.php
\end_layout

\begin_layout Standard
In questa pagina vengono mostrate tutte le ricevute emesse dal ristorante.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require_once("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']) && ($_SESSION['livello']==2)){
\end_layout

\begin_layout Plain Layout

    $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    subtitle("Elenco ricevute emesse");
\end_layout

\begin_layout Plain Layout

    $query= "select Codice, DataPren, CodCliente, Totale from Ricevute natural
 join Prenotazioni order by DataPren";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($query,$conn);
\end_layout

\begin_layout Plain Layout

    $n=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

    if($n>0){
\end_layout

\begin_layout Plain Layout

      $h=array('Codice','Data emissione','Cod.
 Cliente','Totale (Euro)');
\end_layout

\begin_layout Plain Layout

      table_start($h);
\end_layout

\begin_layout Plain Layout

      while($row= mysql_fetch_assoc($ris))
\end_layout

\begin_layout Plain Layout

	echo_row($row);
\end_layout

\begin_layout Plain Layout

      table_end();
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      echo"Non sono ancora state emesse ricevute";
\end_layout

\begin_layout Plain Layout

    };
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

else header("Location: home.php");
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
pren_libera.php
\end_layout

\begin_layout Standard
Tramite pren_libera.php è possibile, per un gestore, inserire una prenotazione
 a nome d'un cliente.
 La pagina è molto simile a crea_pren.php.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

$login=authenticate() or header("Location: home.php");
\end_layout

\begin_layout Plain Layout

if (isset($_SESSION['logged']) && ($_SESSION['livello']==2))
\end_layout

\begin_layout Plain Layout

{
\end_layout

\begin_layout Plain Layout

  inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  subtitle("Inserisci una nuova prenotazione libera");
\end_layout

\begin_layout Plain Layout

  $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  if(isset($_POST['submit'])){
\end_layout

\begin_layout Plain Layout

    $n=0;
\end_layout

\begin_layout Plain Layout

    $pl=$_POST['nporz'];
\end_layout

\begin_layout Plain Layout

    foreach($pl as $d)
\end_layout

\begin_layout Plain Layout

      $n+=$d;
\end_layout

\begin_layout Plain Layout

    if($n!=0){
\end_layout

\begin_layout Plain Layout

      //leggi i dati del cliente
\end_layout

\begin_layout Plain Layout

      //crea la prenotazione in Prenotazioni
\end_layout

\begin_layout Plain Layout

      //poi inserisci ogni piatto in PrenotazioniPiatti
\end_layout

\begin_layout Plain Layout

      $dataP=$_POST['sday'];
\end_layout

\begin_layout Plain Layout

      $np=$_POST['npers'];
\end_layout

\begin_layout Plain Layout

      $idcliente=$_POST['cliente'];
\end_layout

\begin_layout Plain Layout

      $idpr=creapren($idcliente,$dataP,$np) or $err="impossibile inserire
 la prenotazione corrente";
\end_layout

\begin_layout Plain Layout

      if(!isset($err)){
\end_layout

\begin_layout Plain Layout

	$cods=$_POST['ids'];
\end_layout

\begin_layout Plain Layout

	$i=0;
\end_layout

\begin_layout Plain Layout

	foreach($pl as $num){
\end_layout

\begin_layout Plain Layout

	  if($num>0){
\end_layout

\begin_layout Plain Layout

	    $codpiatto=$cods[$i];
\end_layout

\begin_layout Plain Layout

	    $query="insert into PrenotazioniPiatti values($idpr,$codpiatto,$num)";
\end_layout

\begin_layout Plain Layout

	    mysql_query($query,$conn) or $err="errore d'un piatto all'interno della
 prenotazione";
\end_layout

\begin_layout Plain Layout

	    if(isset($err)) echo"$err";
\end_layout

\begin_layout Plain Layout

	  }
\end_layout

\begin_layout Plain Layout

	  $i++;
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

	echo"La prenotazione e` stata inserita con successo<BR>";
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

    else subtitle("nessun piatto selezionato");
\end_layout

\begin_layout Plain Layout

  };
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  $h=array("Antipasti","Primi","Secondi","Contorni","Dolci","PiattiSpeciali","Be
vande");
\end_layout

\begin_layout Plain Layout

  $s=array("Antipasti","Primi","Secondi","Contorni","Dolci","Piatti Speciali","B
evande");
\end_layout

\begin_layout Plain Layout

  echo"<form method='POST' action='pren_libera.php' border='0'>";
\end_layout

\begin_layout Plain Layout

  echo"Inserisci il cliente";
\end_layout

\begin_layout Plain Layout

  echo"<select name='cliente'>";
\end_layout

\begin_layout Plain Layout

  $query="select Id, Login, Nome, Cognome from Clienti natural join Utenti";
\end_layout

\begin_layout Plain Layout

  $ris=(mysql_query($query,$conn));
\end_layout

\begin_layout Plain Layout

  while($row=mysql_fetch_array($ris)){
\end_layout

\begin_layout Plain Layout

    echo"<option value='$row[Id]'>$row[Id] - $row[Login] - $row[Nome] $row[Cogno
me] </option>";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  echo"</select>";
\end_layout

\begin_layout Plain Layout

  echo"<BR>Inserisci il numero di persone:<input type='number' name='npers'
 min=1 size='3' value='1'>";
\end_layout

\begin_layout Plain Layout

  $ardate=mysql_fetch_array(mysql_query("select curdate()",$conn));
\end_layout

\begin_layout Plain Layout

  $date=$ardate[0];
\end_layout

\begin_layout Plain Layout

  echo"     Inserisci la data (nel formato MM/GG/AAAA): <input type='date'
 name='sday' min='$date' value='$date'><BR>";
\end_layout

\begin_layout Plain Layout

  
\end_layout

\begin_layout Plain Layout

  table_start_NH(); 
\end_layout

\begin_layout Plain Layout

  for ($i=0; $i<=6; $i++) {
\end_layout

\begin_layout Plain Layout

    $name=$s[$i];
\end_layout

\begin_layout Plain Layout

    $table=$h[$i];
\end_layout

\begin_layout Plain Layout

    echo "<tr><th colspan='3'>$name </th></tr>";
\end_layout

\begin_layout Plain Layout

    $q="select p.CodPiatto, p.Nome, p.Costo from Piatti p Join $table t where
 p.CodPiatto=t.Codice";
\end_layout

\begin_layout Plain Layout

    $ris=mysql_query($q,$conn);
\end_layout

\begin_layout Plain Layout

    $num_righe=mysql_num_rows($ris);
\end_layout

\begin_layout Plain Layout

    if(!$num_righe)
\end_layout

\begin_layout Plain Layout

      echo"<tr><td>Non ci sono $name</td></tr>";
\end_layout

\begin_layout Plain Layout

    else{
\end_layout

\begin_layout Plain Layout

      while($row=mysql_fetch_array($ris)){
\end_layout

\begin_layout Plain Layout

	echo"<tr><td>".$row["Nome"]."</td><td>".number_format($row["Costo"],2)."€</td>";
\end_layout

\begin_layout Plain Layout

	echo"<input type='hidden' name='ids[]' value='$row[CodPiatto]'>";
\end_layout

\begin_layout Plain Layout

	echo"<td><input type='number' name='nporz[]' min=0 size='3' value='0'></td>";
\end_layout

\begin_layout Plain Layout

	echo"</td></tr>";
\end_layout

\begin_layout Plain Layout

      }
\end_layout

\begin_layout Plain Layout

    }
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

  table_end();
\end_layout

\begin_layout Plain Layout

  if(!isset($_POST['submit']) || !isset($_POST['Cod'])){
\end_layout

\begin_layout Plain Layout

    echo"<input type='submit' name='submit' value='Procedi'>";
\end_layout

\begin_layout Plain Layout

    echo"<input type='reset' value='Cancella'>";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  echo"</form>";
\end_layout

\begin_layout Plain Layout

  back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

}
\end_layout

\begin_layout Plain Layout

else header("Location: home_r.php")
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
risultato.php
\end_layout

\begin_layout Standard
In questa pagina è possibile consultare il menù del ristorante.
 Viene passato tramite GET un parametro corrispondente alla voce che si
 desidera cnsultare, ed il risultato viene generato di conseguenza tramite
 una funzione all'interno della libreria.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate();
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    page_start("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    echo"<table border='0' bgcolor='#FFFF66' cellpadding='10' align='center'
 height='42'>";
\end_layout

\begin_layout Plain Layout

    echo"<tr><td width='1600' align='right' >Benvenuto <b> Ospite! </b>";
\end_layout

\begin_layout Plain Layout

    echo"</td></tr></table>";
\end_layout

\begin_layout Plain Layout

    echo"</div>";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  $conn=dbConnect();
\end_layout

\begin_layout Plain Layout

  $i=$_GET["B1"];
\end_layout

\begin_layout Plain Layout

  if($i=="0"){
\end_layout

\begin_layout Plain Layout

    menu($conn);
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    result($conn,$i);
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    back_home();
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
orari.php
\end_layout

\begin_layout Standard
Questa pagina si limita a mostrare gli orari d'apertura del ristorante.
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "basicstyle={\scriptsize},breaklines=true,frame=single,language=PHP,numbers=left,showstringspaces=false,stepnumber=10"
inline false
status open

\begin_layout Plain Layout

<?php
\end_layout

\begin_layout Plain Layout

  require("libreria.php");
\end_layout

\begin_layout Plain Layout

  $login=authenticate();
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

    inizio_pagina("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

  else{
\end_layout

\begin_layout Plain Layout

    page_start("Ma certo! Ristorante");
\end_layout

\begin_layout Plain Layout

    echo"<table border='0' bgcolor='#FFFF66' cellpadding='10' align='center'
 height='42'>";
\end_layout

\begin_layout Plain Layout

    echo"<tr><td width='1600' align='right' >Benvenuto <b> Ospite! </b>";
\end_layout

\begin_layout Plain Layout

    echo"</td></tr></table>";
\end_layout

\begin_layout Plain Layout

    echo"</div>";
\end_layout

\begin_layout Plain Layout

  }
\end_layout

\begin_layout Plain Layout

  subtitle("Orari del ristorante");
\end_layout

\begin_layout Plain Layout

  Ul_start();
\end_layout

\begin_layout Plain Layout

    Point("Lun:    11:30 - 22:30");
\end_layout

\begin_layout Plain Layout

    Point("Mar:    11:30 - 22:30"); 
\end_layout

\begin_layout Plain Layout

    Point("Mer:    11:30 - 22:30");
\end_layout

\begin_layout Plain Layout

    Point("Gio:    11:30 - 22:30");
\end_layout

\begin_layout Plain Layout

    Point("Ven:    11:30 - 00:00");
\end_layout

\begin_layout Plain Layout

    Point("Sab:    11:30 - 00:00");
\end_layout

\begin_layout Plain Layout

    Point('Dom:    11:30 - 21:30'); 
\end_layout

\begin_layout Plain Layout

  Ul_end();
\end_layout

\begin_layout Plain Layout

  if (isset($_SESSION['logged']))
\end_layout

\begin_layout Plain Layout

    back("operazioni.php");
\end_layout

\begin_layout Plain Layout

  else
\end_layout

\begin_layout Plain Layout

    back_home();
\end_layout

\begin_layout Plain Layout

  page_end();
\end_layout

\begin_layout Plain Layout

?>
\end_layout

\end_inset


\end_layout

\end_body
\end_document
